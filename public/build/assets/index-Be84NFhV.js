import{r as n,j as e,L as K,S}from"./app-0I1QzVTg.js";import{B as r}from"./button-D2ZpcnoY.js";import{D as A,b as O,g as R,c as J,d as L,e as P}from"./dialog-x_8xUkrq.js";import{C as _}from"./circle-help-DWrwDp26.js";import{C as z}from"./chevron-left-B3Wkr27h.js";import{C as M}from"./circle-check-big-Bg27NMmT.js";import{C as F}from"./circle-x-BgkDvUMC.js";import{C as Z}from"./clock-CZHKhQei.js";import{C as ee}from"./chevron-right-c3YFH7gb.js";import{T as H}from"./triangle-alert-CgSD8MvB.js";import"./index-Bota6Y3-.js";import"./index-57D5-Vr4.js";import"./utils-liWpcwDK.js";import"./index-gMo3zbQG.js";import"./index-uHisoZSR.js";import"./Combination-DeKqWJgp.js";import"./x-C19WkH_u.js";import"./createLucideIcon-CstU9H3f.js";function pe({lesson:h,courseSlug:y}){var B,E;const[c,g]=n.useState(0),[o,b]=n.useState({}),[u,T]=n.useState(!1),[l,Q]=n.useState(null),[j,C]=n.useState(0),[m,$]=n.useState(!1),[X,v]=n.useState(!1),[I,k]=n.useState(!1),s=(B=h.quizzes)==null?void 0:B[0],f=n.useRef(null);n.useEffect(()=>{s!=null&&s.time_limit&&!u&&C(s.time_limit*60)},[s]),n.useEffect(()=>{try{if(j>0&&!u){const a=setInterval(()=>{C(t=>t<=1?(q(),0):t-1)},1e3);return()=>clearInterval(a)}}catch(a){console.error("Error in timer useEffect:",a)}},[j,u]),n.useEffect(()=>{if(!(!(s!=null&&s.id)||u))return f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{var t;const a=((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||"";fetch("/quiz/save-progress",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a},body:JSON.stringify({quiz_id:s.id,answers:o}),credentials:"same-origin"})},1e3),()=>{f.current&&clearTimeout(f.current)}},[o,s==null?void 0:s.id,u]),n.useEffect(()=>{s!=null&&s.id&&fetch(`/quiz/get-progress?quiz_id=${s.id}`).then(a=>a.json()).then(a=>{a.answers&&b(a.answers)})},[s==null?void 0:s.id]);const U=(a,t)=>{b(i=>({...i,[a]:t}))},Y=()=>{v(!0)},w=async()=>{var t;if(!(s!=null&&s.id))return;const a=((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||"";await fetch("/quiz/clear-progress",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a},body:JSON.stringify({quiz_id:s.id}),credentials:"same-origin"})},q=async()=>{var a;if(!m){$(!0),v(!1),console.log("Submitting quiz with data:",{quiz_id:s==null?void 0:s.id,answers:o});try{const t=await fetch("/quiz/submit",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"))||""},body:JSON.stringify({quiz_id:s==null?void 0:s.id,answers:o})}),i=await t.json();console.log("Quiz submission response:",i),t.ok?(await w(),Q(i),T(!0)):(console.error("Failed to submit quiz:",i),alert("Gagal mengirim quiz: "+(i.message||i.error||"Unknown error")))}catch(t){console.error("Error submitting quiz:",t),alert("Terjadi kesalahan saat mengirim quiz. Silakan coba lagi.")}finally{$(!1)}}},p=async()=>{if(!u){k(!0);return}await w(),b({}),S.get(`/learn/course/${y}#quiz-${h.id}`)},G=async()=>{await w(),b({}),S.get(`/learn/course/${y}#quiz-${h.id}`)},W=async()=>{await w(),g(0),b({}),T(!1),Q(null),C(s!=null&&s.time_limit?s.time_limit*60:0)},V=a=>{const t=Math.floor(a/60),i=a%60;return`${t}:${i.toString().padStart(2,"0")}`};if(!s)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{className:"text-muted-foreground mb-4 h-16 w-16 mx-auto"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Quiz Belum Tersedia"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:"Quiz untuk materi ini belum tersedia."}),e.jsx(r,{onClick:p,children:"Kembali ke Dashboard"})]})});if(!s.questions||s.questions.length===0)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{className:"text-muted-foreground mb-4 h-16 w-16 mx-auto"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Soal Quiz Belum Tersedia"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:"Belum ada soal untuk quiz ini."}),e.jsx(r,{onClick:p,children:"Kembali ke Dashboard"})]})});if(u&&l)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(K,{title:`Hasil Quiz: ${s.title}`}),e.jsx("div",{className:"border-b bg-card/50 backdrop-blur supports-[backdrop-filter]:bg-card/50",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(r,{variant:"ghost",size:"sm",onClick:p,className:"gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Kembali ke Dashboard"]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-xl font-semibold",children:["Hasil Quiz: ",s.title]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:h.title})]})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:`inline-flex items-center justify-center w-16 h-16 rounded-full mb-4 ${l.is_passed?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:l.is_passed?e.jsx(M,{className:"w-8 h-8"}):e.jsx(F,{className:"w-8 h-8"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:l.is_passed?"Selamat! Anda Lulus":"Belum Lulus"}),e.jsxs("div",{className:"flex justify-center gap-6 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Skor: ",l.score,"%"]}),e.jsxs("span",{children:["Benar: ",l.correct_answers,"/",l.total_questions]}),e.jsxs("span",{children:["Waktu: ",Math.floor(l.time_taken/60),":",(l.time_taken%60).toString().padStart(2,"0")]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(r,{variant:"outline",onClick:p,children:"← Kembali ke Dashboard Quiz"}),e.jsx(r,{onClick:W,children:"🔄 Ulangi Quiz"})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Review Jawaban"}),(E=l.answers_summary)==null?void 0:E.map((a,t)=>{var i;return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:`inline-flex items-center gap-2 text-sm font-medium mb-2 ${a.is_correct?"text-green-600":"text-red-600"}`,children:[a.is_correct?e.jsx(M,{className:"w-4 h-4"}):e.jsx(F,{className:"w-4 h-4"}),"Soal ",t+1," - ",a.is_correct?"Benar":"Salah"]}),e.jsx("p",{className:"font-medium mb-3",children:a.question}),e.jsx("div",{className:"space-y-2",children:(i=a.options)==null?void 0:i.map(d=>e.jsx("div",{className:`p-2 rounded border ${d.is_correct?"bg-green-50 border-green-200":d.id===a.selected_option_id?"bg-red-50 border-red-200":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${d.is_correct?"bg-green-500":d.id===a.selected_option_id?"bg-red-500":"bg-gray-300"}`}),e.jsx("span",{children:d.option_text}),d.is_correct&&e.jsx("span",{className:"text-green-600 text-sm",children:"(Jawaban Benar)"}),d.id===a.selected_option_id&&!d.is_correct&&e.jsx("span",{className:"text-red-600 text-sm",children:"(Jawaban Anda)"})]})},d.id))})]},a.question_id)})]})]})})]});const x=s.questions[c],N=s.questions.length,D=Object.keys(o).length;return x?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(K,{title:`Quiz: ${s.title}`}),e.jsx("div",{className:"border-b bg-card/50 backdrop-blur supports-[backdrop-filter]:bg-card/50",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(r,{variant:"ghost",size:"sm",onClick:G,className:"gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Kembali"]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-semibold",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:h.title})]}),s.time_limit&&j>0?e.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-full ${j<=60?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"}`,children:[e.jsx(Z,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-lg",children:V(j)})]}):s.time_limit===0&&e.jsx("div",{className:"text-red-600 text-sm font-semibold px-4 py-2 border border-red-200 bg-red-50 rounded",children:"Quiz ini tidak memiliki durasi pengerjaan"})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[s.instructions&&e.jsx("p",{className:"text-muted-foreground mb-4",children:s.instructions}),e.jsx("div",{className:"bg-gray-200 rounded-full h-3 mb-2",children:e.jsx("div",{className:"bg-blue-900 h-3 rounded-full transition-all duration-300",style:{width:`${(c+1)/N*100}%`}})}),e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Soal ",c+1," dari ",N]}),e.jsxs("span",{children:[D," jawaban tersimpan"]})]})]}),e.jsxs("div",{className:"flex gap-6 flex-col md:flex-row",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-card border rounded-lg p-6 mb-6",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-6",children:[c+1,". ",x.question_text]}),e.jsx("div",{className:"space-y-4",children:x.options&&x.options.length>0?x.options.map(a=>e.jsxs("label",{className:"flex items-center gap-4 p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:`question-${x.id}`,value:a.id,checked:o[x.id]===a.id,onChange:()=>U(x.id,a.id),className:"w-5 h-5"}),e.jsx("span",{className:"text-base",children:a.option_text})]},a.id)):e.jsx("div",{className:"text-center p-4 text-muted-foreground",children:e.jsx("p",{children:"Pilihan jawaban belum tersedia untuk soal ini."})})})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(r,{variant:"outline",size:"lg",onClick:()=>g(a=>Math.max(0,a-1)),disabled:c===0,children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Sebelumnya"]}),c===N-1?e.jsx(r,{size:"lg",onClick:Y,disabled:m||D===0,children:m?"Mengirim...":"Selesai Quiz"}):e.jsxs(r,{size:"lg",onClick:()=>g(a=>Math.min(N-1,a+1)),disabled:c===N-1,children:["Selanjutnya",e.jsx(ee,{className:"w-4 h-4 ml-2"})]})]}),e.jsx("div",{className:"block md:hidden",children:e.jsxs("div",{className:"bg-card border rounded-lg p-4 mt-2",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Navigasi Soal"}),e.jsx("div",{className:"grid grid-cols-6 gap-2 mb-4",children:s.questions.map((a,t)=>{var i;return e.jsx("button",{onClick:()=>g(t),className:`w-10 h-10 rounded text-sm font-medium transition-colors ${t===c?"bg-blue-900 text-white":o[(i=s.questions[t])==null?void 0:i.id]?"bg-green-100 text-green-700 border border-green-300":"bg-gray-100 hover:bg-gray-200"}`,children:t+1},t)})})]})})]})]}),e.jsx("div",{className:"w-80 hidden md:block",children:e.jsxs("div",{className:"bg-card border rounded-lg p-6 sticky top-6",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Navigasi Soal"}),e.jsx("div",{className:"grid grid-cols-6 gap-2 mb-6",children:s.questions.map((a,t)=>{var i;return e.jsx("button",{onClick:()=>g(t),className:`w-10 h-10 rounded text-sm font-medium transition-colors ${t===c?"bg-blue-900 text-white":o[(i=s.questions[t])==null?void 0:i.id]?"bg-green-100 text-green-700 border border-green-300":"bg-gray-100 hover:bg-gray-200"}`,children:t+1},t)})}),e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-900 rounded"}),e.jsx("span",{children:"Soal saat ini"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 bg-green-100 border border-green-300 rounded"}),e.jsx("span",{children:"Sudah dijawab"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-100 rounded"}),e.jsx("span",{children:"Belum dijawab"})]})]})})]})})]})]})}),e.jsx(A,{open:X,onOpenChange:v,children:e.jsxs(O,{className:"sm:max-w-[425px]",children:[e.jsxs(R,{children:[e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-amber-500"}),"Konfirmasi Pengiriman"]}),e.jsx(L,{children:"Setelah dikirim, Anda tidak dapat mengubah jawaban lagi."})]}),e.jsxs(P,{children:[e.jsx(r,{variant:"outline",onClick:()=>v(!1),disabled:m,children:"Batal"}),e.jsx(r,{onClick:q,disabled:m,children:m?"Mengirim...":"Ya, Kirim Jawaban"})]})]})}),e.jsx(A,{open:I,onOpenChange:k,children:e.jsxs(O,{className:"sm:max-w-[425px]",children:[e.jsxs(R,{children:[e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-amber-500"}),"Konfirmasi Keluar Quiz"]}),e.jsxs(L,{children:["Apakah Anda yakin ingin keluar? ",e.jsx("span",{className:"font-semibold text-red-600",children:"Jawaban Anda tidak akan terekam."})]})]}),e.jsxs(P,{children:[e.jsx(r,{variant:"outline",onClick:()=>k(!1),disabled:m,children:"Batal"}),e.jsx(r,{onClick:()=>{k(!1),S.get(`/learn/course/${y}#quiz-${h.id}`)},disabled:m,children:"Ya, Keluar Quiz"})]})]})})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{className:"text-muted-foreground mb-4 h-16 w-16 mx-auto"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Error Loading Question"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:"Terjadi kesalahan saat memuat soal."}),e.jsx(r,{onClick:p,children:"Kembali ke Dashboard"})]})})}export{pe as default};
