import{r as v,m as C,j as e}from"./app-BfgZ1jJD.js";import{B as k}from"./button-BJ2tfxUg.js";import{D as P,b as S,g as E,c as I,d as R}from"./dialog-CblXDkko.js";import{I as o}from"./input-DAiJIf4x.js";import{L as l}from"./label-wqJbabk0.js";import{S as T}from"./switch-DocqSJvB.js";import{t as c}from"./index-CUDXU6sL.js";import"./index-Cmel2OYl.js";import"./index-yQBepqoG.js";import"./utils-C1iKCs30.js";import"./index-DtSPkv89.js";import"./index-tEHxzkPb.js";import"./Combination-Dyc663Sd.js";import"./x-CquPhaxv.js";import"./createLucideIcon-DE9Tn2K0.js";function X({promotion:t,open:h,onOpenChange:x,promotions:b}){const[f,p]=v.useState(t.promotion_flyer),m=b.some(a=>a.is_active===!0&&a.id!==t.id),d=a=>a?new Date(a).toISOString().split("T")[0]:"",{data:s,setData:i,post:N,processing:u,errors:r}=C({promotion_flyer:null,start_date:d(t.start_date),end_date:d(t.end_date),is_active:t.is_active,url_redirect:t.url_redirect||"",_method:"PUT"});v.useEffect(()=>{t&&(i({promotion_flyer:null,start_date:d(t.start_date),end_date:d(t.end_date),is_active:t.is_active,url_redirect:t.url_redirect||"",_method:"PUT"}),p(t.promotion_flyer))},[t,h,i]);const D=a=>{var y;const n=(y=a.target.files)==null?void 0:y[0];if(n){i("promotion_flyer",n);const g=new FileReader;g.onload=w=>{var j;p((j=w.target)==null?void 0:j.result)},g.readAsDataURL(n)}},F=a=>{if(a.preventDefault(),s.is_active&&m){c.error("Hanya boleh ada satu flyer promosi yang aktif. Nonaktifkan flyer yang aktif terlebih dahulu.");return}N(route("promotions.update",t.id),{onSuccess:()=>{x(!1),c.success("Flyer promosi berhasil diperbarui")},onError:()=>{c.error("Gagal memperbarui flyer promosi")}})},_=()=>{x(!1)};return e.jsx(P,{open:h,onOpenChange:_,children:e.jsxs(S,{className:"scrollbar-hide max-h-[90vh] max-w-2xl overflow-y-auto",children:[e.jsxs(E,{children:[e.jsx(I,{children:"Edit Flyer Promosi"}),e.jsx(R,{children:"Ubah data flyer promosi."})]}),e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"promotion_flyer",children:"Gambar Flyer"}),e.jsx(o,{id:"promotion_flyer",type:"file",accept:"image/*",onChange:D,className:"cursor-pointer"}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"Biarkan kosong jika tidak ingin mengubah gambar"}),r.promotion_flyer&&e.jsx("p",{className:"text-sm text-red-600",children:r.promotion_flyer}),f&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-gray-700",children:"Preview:"}),e.jsx("img",{src:f,alt:"Preview flyer",className:"max-h-64 w-full rounded-lg border object-contain"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"start_date",children:"Tanggal Mulai *"}),e.jsx(o,{id:"start_date",type:"date",value:s.start_date,onChange:a=>i("start_date",a.target.value),required:!0}),r.start_date&&e.jsx("p",{className:"text-sm text-red-600",children:r.start_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"end_date",children:"Tanggal Selesai *"}),e.jsx(o,{id:"end_date",type:"date",value:s.end_date,onChange:a=>i("end_date",a.target.value),required:!0}),r.end_date&&e.jsx("p",{className:"text-sm text-red-600",children:r.end_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"url_redirect",children:"URL Redirect"}),e.jsx(o,{id:"url_redirect",type:"url",placeholder:"https://example.com",value:s.url_redirect,onChange:a=>i("url_redirect",a.target.value)}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"URL yang akan dibuka ketika flyer diklik (opsional)"}),r.url_redirect&&e.jsx("p",{className:"text-sm text-red-600",children:r.url_redirect})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:"is_active",checked:s.is_active,onCheckedChange:a=>{if(a&&m){c.warning("Sudah ada flyer promosi yang aktif. Nonaktifkan flyer yang aktif terlebih dahulu.");return}i("is_active",a)}}),e.jsx(l,{htmlFor:"is_active",children:s.is_active?"Flyer Aktif":"Flyer Nonaktif"})]}),m&&!s.is_active&&e.jsx("p",{className:"text-xs text-amber-600",children:"⚠️ Ada flyer promosi lain yang sedang aktif. Nonaktifkan terlebih dahulu untuk mengaktifkan flyer ini."})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(k,{type:"button",variant:"outline",onClick:_,disabled:u,children:"Batal"}),e.jsx(k,{type:"submit",disabled:u,children:u?"Menyimpan...":"Simpan Perubahan"})]})]})]})})}export{X as default};
