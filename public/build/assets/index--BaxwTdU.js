import{K as le,r as c,j as e,L,$ as H,S as ne}from"./app-BfgZ1jJD.js";import{B as d}from"./button-BJ2tfxUg.js";import{C as ie}from"./checkbox-C-xsN1qh.js";import{I as _}from"./input-DAiJIf4x.js";import{L as u}from"./label-wqJbabk0.js";import{S as K}from"./separator-OAx4gj7V.js";import{U as B}from"./user-layout-C3EN8Aa5.js";import{t as T}from"./index-CUDXU6sL.js";import{U as $}from"./user-954k5RzP.js";import{B as ce}from"./badge-check-B2vOYKsc.js";import{H as de}from"./hourglass-Bjlb9Wb3.js";import{C as O}from"./check-A_SiYeLL.js";import{X as me}from"./x-CquPhaxv.js";import"./index-Cmel2OYl.js";import"./index-yQBepqoG.js";import"./utils-C1iKCs30.js";import"./index-Z40DZPLH.js";import"./index-tEHxzkPb.js";import"./index-Dn_VzzJM.js";import"./floating-ui.react-dom-C37UeumF.js";import"./index-CB0yihhM.js";import"./index-Co0ZWakJ.js";import"./sonner-DK45uaK0.js";import"./breadcrumbs-CIofoTQN.js";import"./createLucideIcon-DE9Tn2K0.js";import"./index-DtSPkv89.js";import"./Combination-Dyc663Sd.js";import"./tooltip-YszIhp1B.js";import"./index-DkgfW9Gg.js";import"./dropdown-menu-D-RFvgcT.js";import"./index-W6qf3D2J.js";import"./chevron-right-BoyAfqJq.js";import"./mail-1ViNCBmL.js";import"./phone-CV8fUjTg.js";import"./icon-CJLH4TFi.js";import"./house-CyIjaNKi.js";import"./monitor-play-DF4fahFT.js";function Xe({webinar:s,hasAccess:J,pendingInvoiceUrl:I,referralInfo:m}){var q;const{auth:M}=le().props,D=!!M.user,N=D&&((q=M.user)==null?void 0:q.phone_number),[v,X]=c.useState(!1),[j,p]=c.useState(!1),[f,Q]=c.useState(""),[o,k]=c.useState(null),[R,E]=c.useState(!1),[S,x]=c.useState(""),[V,U]=c.useState(!1),[l,F]=c.useState({ig_follow_proof_1:null,ig_follow_proof_2:null,ig_follow_proof_3:null,tag_friend_proof:null}),[n,h]=c.useState({ig_follow_proof_1:!1,ig_follow_proof_2:!1,ig_follow_proof_3:!1,tag_friend_proof:!1}),i=s.price===0,P=5e3,Y=s.price,Z=(o==null?void 0:o.discount_amount)||0,z=Y-Z,W=i?0:z+P;c.useEffect(()=>{const t=new URLSearchParams(window.location.search).get("ref");t?sessionStorage.setItem("referral_code",t):m.code&&sessionStorage.setItem("referral_code",m.code)},[m]),c.useEffect(()=>{if(!f.trim()||i){k(null),x("");return}const a=setTimeout(()=>{ee()},500);return()=>clearTimeout(a)},[f]);const ee=async()=>{var a;if(!(!f.trim()||i)){E(!0),x("");try{const r=await(await fetch("/api/discount-codes/validate",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.content)||""},credentials:"same-origin",body:JSON.stringify({code:f,amount:s.price,product_type:"webinar",product_id:s.id})})).json();r.valid?(k(r),x("")):(k(null),x(r.message||"Kode promo tidak valid"))}catch{k(null),x("Terjadi kesalahan saat memvalidasi kode promo")}finally{E(!1)}}},ae=async()=>{try{const t=await(await fetch("/csrf-token",{method:"GET",credentials:"same-origin"})).json(),r=document.querySelector('meta[name="csrf-token"]');return r&&(r.content=t.token),t.token}catch(a){throw console.error("Failed to refresh CSRF token:",a),a}},te=a=>{if(a.preventDefault(),!N){alert("Profil Anda belum lengkap! Harap lengkapi nomor telepon terlebih dahulu."),window.location.href=route("profile.edit");return}if(!l.ig_follow_proof_1||!l.ig_follow_proof_2||!l.ig_follow_proof_3||!l.tag_friend_proof){alert("Harap upload semua bukti follow dan tag yang diperlukan!");return}p(!0);const t=new FormData;t.append("type","webinar"),t.append("id",s.id),t.append("ig_follow_proof_1",l.ig_follow_proof_1),t.append("ig_follow_proof_2",l.ig_follow_proof_2),t.append("ig_follow_proof_3",l.ig_follow_proof_3),t.append("tag_friend_proof",l.tag_friend_proof),ne.post(route("enroll.free"),t,{onError:r=>{alert(r.message||"Gagal mendaftar webinar gratis.")},onFinish:()=>{p(!1)}})},re=async a=>{if(a.preventDefault(),!N){alert("Profil Anda belum lengkap! Harap lengkapi nomor telepon terlebih dahulu."),window.location.href=route("profile.edit");return}if(!v&&!i){alert("Anda harus menyetujui syarat dan ketentuan!");return}if(p(!0),i){U(!0),p(!1);return}const t=async(r=0)=>{var G;const g=s.strikethrough_price>0?s.strikethrough_price-s.price:0,oe=(o==null?void 0:o.discount_amount)||0,C={type:"webinar",id:s.id,discount_amount:g+oe,nett_amount:z,transaction_fee:P,total_amount:W};o!=null&&o.valid&&(C.discount_code_id=o.discount_code.id,C.discount_code_amount=o.discount_amount);try{const y=(G=document.querySelector('meta[name="csrf-token"]'))==null?void 0:G.content,A=await fetch(route("invoice.store"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":y||"",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify(C)});if(A.status===419&&r<2)return console.log(`CSRF token expired, refreshing... (attempt ${r+1})`),await ae(),t(r+1);const b=await A.json();if(A.ok&&b.success)if(b.payment_url)window.location.href=b.payment_url;else throw new Error("Payment URL not received");else throw new Error(b.message||"Gagal membuat invoice.")}catch(y){throw console.error("Payment error:",y),y}};try{await t()}catch(r){alert(r.message||"Terjadi kesalahan saat proses pembayaran."),p(!1)}},se=(a,t=2)=>{const r=t*1024*1024;return a.size<=r},w=(a,t)=>{if(!t){F(r=>({...r,[a]:null})),h(r=>({...r,[a]:!1}));return}if(!se(t,2)){h(g=>({...g,[a]:!0}));const r=document.querySelector(`input[data-field="${a}"]`);r&&(r.value=""),T.error("Ukuran file terlalu besar. Maksimal 2MB.");return}if(!t.type.startsWith("image/")){h(g=>({...g,[a]:!0}));const r=document.querySelector(`input[data-field="${a}"]`);r&&(r.value=""),T.error("Hanya file gambar (JPG, PNG, GIF, dll) yang diperbolehkan.");return}F(r=>({...r,[a]:t})),h(r=>({...r,[a]:!1})),T.success("File berhasil diunggah.")};if(!D){const a=window.location.href,t=route("login",{redirect:a});return e.jsxs(B,{children:[e.jsx(L,{title:"Login Required"}),e.jsx("section",{className:"to-tertiary from-primary w-full bg-gradient-to-br px-4",children:e.jsxs("div",{className:"mx-auto my-18 w-full max-w-7xl px-4",children:[e.jsxs("h2",{className:"mx-auto mb-4 max-w-3xl text-center text-3xl font-bold text-white sm:text-4xl",children:['Daftar Webinar "',s.title,'"']}),e.jsx("img",{src:s.thumbnail?`/storage/${s.thumbnail}`:"/assets/images/placeholder.png",alt:s.title,className:"mx-auto my-6 w-full max-w-xl rounded-lg border border-gray-200 shadow-md"}),e.jsx("p",{className:"text-center text-gray-200",children:"Silakan login terlebih dahulu untuk mendaftar webinar."})]})}),e.jsx("section",{className:"mx-auto my-4 w-full max-w-7xl px-4",children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx($,{size:64,className:"text-blue-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Login Diperlukan"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Anda perlu login terlebih dahulu untuk mendaftar webinar ini.",m.hasActive&&" Kode referral Anda akan tetap tersimpan."]}),e.jsxs("div",{className:"flex w-full max-w-md gap-2",children:[e.jsx(d,{asChild:!0,className:"flex-1",children:e.jsx("a",{href:t,children:"Login"})}),e.jsx(d,{asChild:!0,variant:"outline",className:"flex-1",children:e.jsx(H,{href:route("register",m.code?{ref:m.code}:{}),children:"Daftar"})})]})]})})]})}return N?e.jsxs(B,{children:[e.jsx(L,{title:"Daftar Webinar"}),e.jsx("section",{className:"to-tertiary from-primary w-full bg-gradient-to-br px-4",children:e.jsxs("div",{className:"mx-auto my-18 w-full max-w-7xl px-4",children:[e.jsxs("h2",{className:"mx-auto mb-4 max-w-3xl text-center text-3xl font-bold text-white sm:text-4xl",children:['Daftar Webinar "',s.title,'"']}),e.jsx("img",{src:s.thumbnail?`/storage/${s.thumbnail}`:"/assets/images/placeholder.png",alt:s.title,className:"mx-auto my-6 w-full max-w-xl rounded-lg border border-gray-200 shadow-md"}),e.jsx("p",{className:"text-center text-gray-200",children:i?"Silahkan lengkapi persyaratan berikut untuk mendaftar webinar.":"Silakan selesaikan pembayaran untuk mendaftar webinar."})]})}),e.jsx("section",{className:"mx-auto my-4 w-full max-w-7xl px-4",children:e.jsx("div",{className:"w-full",children:J?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx(ce,{size:64,className:"text-green-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Anda Sudah Memiliki Akses"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Anda sudah terdaftar di webinar ini. Silakan masuk ke dalam grup."}),e.jsx(d,{asChild:!0,className:"w-full",children:e.jsx("a",{href:s.group_url??"",target:"_blank",rel:"noopener noreferrer",children:"Masuk Group Webinar"})})]}):I?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx(de,{size:64,className:"text-yellow-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Pembayaran Tertunda"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Anda memiliki pembayaran yang belum selesai untuk webinar ini. Silakan lanjutkan untuk membayar."}),e.jsx(d,{asChild:!0,className:"w-full",children:e.jsx("a",{href:I,children:"Lanjutkan Pembayaran"})})]}):V?e.jsxs("form",{onSubmit:te,children:[e.jsx("h2",{className:"my-2 text-xl font-bold italic",children:"Upload Bukti Follow"}),e.jsxs("div",{className:"space-y-4 rounded-lg border p-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"ig_follow_proof_1",children:"Bukti Follow Instagram @arsacendekia"}),e.jsx(_,{id:"ig_follow_proof_1","data-field":"ig_follow_proof_1",type:"file",accept:"image/*",onChange:a=>{var t;return w("ig_follow_proof_1",((t=a.target.files)==null?void 0:t[0])||null)},className:n.ig_follow_proof_1?"border-red-500 focus:ring-red-500":"",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Screenshot halaman profil Instagram kami yang menunjukkan Anda sudah follow @arsacendekia (Maks. 2MB)"}),n.ig_follow_proof_1&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:"File tidak valid. Pastikan ukuran tidak melebihi 2MB dan format gambar."})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"ig_follow_proof_2",children:"Bukti Follow Instagram @lulustarget.idn"}),e.jsx(_,{id:"ig_follow_proof_2","data-field":"ig_follow_proof_2",type:"file",accept:"image/*",onChange:a=>{var t;return w("ig_follow_proof_2",((t=a.target.files)==null?void 0:t[0])||null)},className:n.ig_follow_proof_2?"border-red-500 focus:ring-red-500":"",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Screenshot halaman profil Instagram kami yang menunjukkan Anda sudah follow @lulustarget.idn (Maks. 2MB)"}),n.ig_follow_proof_2&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:"File tidak valid. Pastikan ukuran tidak melebihi 2MB dan format gambar."})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"ig_follow_proof_3",children:"Bukti Follow Instagram @zona.accounting"}),e.jsx(_,{id:"ig_follow_proof_3","data-field":"ig_follow_proof_3",type:"file",accept:"image/*",onChange:a=>{var t;return w("ig_follow_proof_3",((t=a.target.files)==null?void 0:t[0])||null)},className:n.ig_follow_proof_3?"border-red-500 focus:ring-red-500":"",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Screenshot halaman profil Instagram kami yang menunjukkan Anda sudah follow @zona.accounting (Maks. 2MB)"}),n.ig_follow_proof_3&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:"File tidak valid. Pastikan ukuran tidak melebihi 2MB dan format gambar."})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"tag_friend_proof",children:"Bukti Tag 3 Teman di Instagram"}),e.jsx(_,{id:"tag_friend_proof","data-field":"tag_friend_proof",type:"file",accept:"image/*",onChange:a=>{var t;return w("tag_friend_proof",((t=a.target.files)==null?void 0:t[0])||null)},className:n.tag_friend_proof?"border-red-500 focus:ring-red-500":"",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Screenshot postingan Instagram kami yang menunjukkan Anda sudah tag 3 teman di komentar (Maks. 2MB)"}),n.tag_friend_proof&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:"File tidak valid. Pastikan ukuran tidak melebihi 2MB dan format gambar."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>{U(!1),h({ig_follow_proof_1:!1,ig_follow_proof_2:!1,ig_follow_proof_3:!1,tag_friend_proof:!1}),F({ig_follow_proof_1:null,ig_follow_proof_2:null,ig_follow_proof_3:null,tag_friend_proof:null})},className:"flex-1",children:"Kembali"}),e.jsx(d,{type:"submit",disabled:j||!l.ig_follow_proof_1||!l.ig_follow_proof_2||!l.ig_follow_proof_3||!l.tag_friend_proof||n.ig_follow_proof_1||n.ig_follow_proof_2||n.ig_follow_proof_3||n.tag_friend_proof,className:"flex-1",children:j?"Memproses...":"Dapatkan Akses Gratis"})]})]})]}):e.jsxs("form",{onSubmit:re,children:[e.jsxs("h2",{className:"my-2 text-xl font-bold",children:["Detail ",i?"Pendaftaran":"Pembayaran"]}),e.jsxs("div",{className:"space-y-4 rounded-lg border p-4",children:[i?e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("div",{className:"flex items-center justify-between p-4",children:e.jsx("span",{className:"w-full text-2xl font-bold text-green-600",children:"WEBINAR GRATIS"})}),e.jsx("p",{className:"text-sm text-gray-600",children:"Untuk mendapatkan akses gratis, Anda perlu:"}),e.jsxs("ul",{className:"space-y-1 text-left text-sm",children:[e.jsxs("li",{children:["• Follow Instagram"," ",e.jsx("a",{href:"https://www.instagram.com/arsacendekia/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline",children:"@arsacendekia"})]}),e.jsxs("li",{children:["• Follow Instagram"," ",e.jsx("a",{href:"https://www.instagram.com/lulustarget.idn/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline",children:"@lulustarget.idn"})]}),e.jsxs("li",{children:["• Follow Instagram"," ",e.jsx("a",{href:"https://www.instagram.com/zona.accounting/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline",children:"@zona.accounting"})]}),e.jsx("li",{children:"• Tag 3 teman di postingan Instagram kami"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Upload bukti follow dan tag untuk mendapatkan akses"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"promo-code",children:"Kode Promo (Opsional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{id:"promo-code",type:"text",placeholder:"Masukkan kode promo",value:f,onChange:a=>Q(a.target.value.toUpperCase()),className:"pr-10"}),R&&e.jsx("div",{className:"absolute top-1/2 right-3 -translate-y-1/2 transform",children:e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-b-2 border-blue-600"})}),!R&&f&&e.jsx("div",{className:"absolute top-1/2 right-3 -translate-y-1/2 transform",children:o!=null&&o.valid?e.jsx(O,{className:"h-4 w-4 text-green-600"}):S?e.jsx(me,{className:"h-4 w-4 text-red-600"}):null})]}),S&&e.jsx("p",{className:"text-sm text-red-600",children:S}),(o==null?void 0:o.valid)&&e.jsxs("div",{className:"rounded-lg border border-green-200 bg-green-50 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4 text-green-600"}),e.jsxs("p",{className:"text-sm font-medium text-green-800",children:['Kode promo "',o.discount_code.code,'" berhasil diterapkan!']})]}),e.jsxs("p",{className:"mt-1 text-xs text-green-600",children:[o.discount_code.name," - Diskon ",o.discount_code.formatted_value]})]})]}),e.jsxs("div",{className:"space-y-2 rounded-lg border p-4",children:[s.strikethrough_price>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Harga Asli"}),e.jsxs("span",{className:"font-semibold text-gray-500 line-through",children:["Rp ",s.strikethrough_price.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Diskon"}),e.jsxs("span",{className:"font-semibold text-red-500",children:["-Rp ",(s.strikethrough_price-s.price).toLocaleString("id-ID")]})]}),e.jsx(K,{className:"my-2"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Harga Webinar"}),e.jsxs("span",{className:"font-semibold text-gray-500",children:["Rp ",s.price.toLocaleString("id-ID")]})]}),(o==null?void 0:o.valid)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["Diskon Promo (",o.discount_code.code,")"]}),e.jsxs("span",{className:"font-semibold text-green-600",children:["-Rp ",o.discount_amount.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Biaya Transaksi"}),e.jsxs("span",{className:"font-semibold text-gray-500",children:["Rp ",P.toLocaleString("id-ID")]})]}),e.jsx(K,{className:"my-2"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Total Pembayaran"}),e.jsxs("span",{className:"text-primary text-xl font-bold",children:["Rp ",W.toLocaleString("id-ID")]})]})]})]}),!i&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{id:"terms",checked:v,onCheckedChange:a=>X(a===!0)}),e.jsxs(u,{htmlFor:"terms",children:["Saya menyetujui"," ",e.jsx("a",{href:"/terms-and-conditions",target:"_blank",rel:"noopener noreferrer",className:"text-blue-700 hover:underline",children:"syarat dan ketentuan"})]})]}),e.jsx(d,{className:"w-full",type:"submit",disabled:(i?!1:!v)||j,children:j?"Memproses...":i?"Upload Syarat Pendaftaran":"Lanjutkan Pembayaran"})]})]})})})]}):e.jsxs(B,{children:[e.jsx(L,{title:"Daftar Webinar"}),e.jsx("section",{className:"to-tertiary from-primary w-full bg-gradient-to-br px-4",children:e.jsxs("div",{className:"mx-auto my-18 w-full max-w-7xl px-4",children:[e.jsxs("h2",{className:"mx-auto mb-4 max-w-3xl text-center text-3xl font-bold text-white sm:text-4xl",children:['Daftar Webinar "',s.title,'"']}),e.jsx("img",{src:s.thumbnail?`/storage/${s.thumbnail}`:"/assets/images/placeholder.png",alt:s.title,className:"mx-auto my-6 w-full max-w-xl rounded-lg border border-gray-200 shadow-md"}),e.jsx("p",{className:"text-center text-gray-200",children:"Silakan lengkapi profil Anda terlebih dahulu."})]})}),e.jsx("section",{className:"mx-auto my-4 w-full max-w-7xl px-4",children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx($,{size:64,className:"text-orange-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Profil Belum Lengkap"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Profil Anda belum lengkap! Harap lengkapi nomor telepon terlebih dahulu untuk mendaftar webinar."}),e.jsx(d,{asChild:!0,className:"w-full max-w-md",children:e.jsx(H,{href:route("profile.edit",{redirect:window.location.href}),children:"Lengkapi Profil"})})]})})]})}export{Xe as default};
