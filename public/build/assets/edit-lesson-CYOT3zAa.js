import{r,j as e}from"./app-CoagF3OV.js";import{I as G}from"./input-error-D1VF60E_.js";import{B as J}from"./button-DiwSB_ws.js";import{b as O,c as X,d as Z,e as H,f as ee}from"./dialog-B6AyxOKJ.js";import{I as d}from"./input-BMF2iBSR.js";import{L as n}from"./label-Dp7V1G_b.js";import{S as te,a as ie,b as ae,c as re,e as se,d as u}from"./select-CCZ0ra5z.js";import{S as K}from"./switch-B3DfobN3.js";import{T as W}from"./textarea-HtiC7Uui.js";import{E as le}from"./Editor-CexBbJ39.js";import"./utils-C9PFdcQI.js";import"./index-BXEQ4bzJ.js";import"./index-CvEpHCJr.js";import"./index-DS7d39Bl.js";import"./index-CokJC4k2.js";import"./Combination-BqWVWUy8.js";import"./x--5bXEWR7.js";import"./createLucideIcon-CbJIzLBb.js";import"./index-l9Ya2sLU.js";import"./index-CMuwh_Aq.js";import"./floating-ui.react-dom-BaCIZNLQ.js";import"./index-C9rWrU68.js";import"./index-VR4SfWyp.js";import"./index-DRkvNbUN.js";import"./chevron-down-C6u_SFWf.js";import"./chevron-up-CtLTSdrd.js";import"./index-DcjPkLrC.js";function ne(p){const h=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,t=p.match(h);return t&&t[2].length===11?t[2]:""}const oe=50*1024*1024;function Le({setOpen:p,onEdit:h,lesson:t}){var L,M,B,Q,U,V;const[x,y]=r.useState(t.title),[s,w]=r.useState(t.type),[k,z]=r.useState(t.description??""),[f,F]=r.useState(t.is_free??!1),[N,S]=r.useState(t.content??""),[c,_]=r.useState(t.video_url??""),[a,v]=r.useState(t.attachment??null),[Y,g]=r.useState(""),[q,C]=r.useState(((M=(L=t.quizzes)==null?void 0:L[0])==null?void 0:M.instructions)||""),[D,P]=r.useState(((Q=(B=t.quizzes)==null?void 0:B[0])==null?void 0:Q.time_limit)||0),[E,I]=r.useState(((V=(U=t.quizzes)==null?void 0:U[0])==null?void 0:V.passing_score)||0),[b,j]=r.useState(t.is_preview!==void 0?t.is_preview:!0),T=r.useRef(null);r.useEffect(()=>{var i,l,o,m,R,A;y(t.title),w(t.type),z(t.description??""),F(t.is_free??!1),S(t.content??""),_(t.video_url??""),v(t.attachment??null),C(((l=(i=t.quizzes)==null?void 0:i[0])==null?void 0:l.instructions)||""),P(((m=(o=t.quizzes)==null?void 0:o[0])==null?void 0:m.time_limit)||0),I(((A=(R=t.quizzes)==null?void 0:R[0])==null?void 0:A.passing_score)||0),g(""),j(t.is_preview!==void 0?t.is_preview:!0)},[t]);const $=i=>{var l,o,m;if(i.preventDefault(),!x.trim()){g("Judul materi harus diisi"),(l=T.current)==null||l.focus();return}h({id:t.id,title:x,type:s,description:k,is_free:f,content:s==="text"?N:void 0,video_url:s==="video"?c:void 0,attachment:s==="file"?a??t.attachment:void 0,quizzes:s==="quiz"?[{id:(m=(o=t.quizzes)==null?void 0:o[0])==null?void 0:m.id,instructions:q,time_limit:D,passing_score:E}]:void 0,is_preview:s==="file"?b:t.is_preview})};return e.jsxs(O,{children:[e.jsx(X,{children:"Edit Materi"}),e.jsx(Z,{children:"Ubah judul, tipe, dan deskripsi materi."}),e.jsxs("form",{className:"space-y-6",onSubmit:$,children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"title",className:"sr-only",children:"Judul Materi"}),e.jsx(d,{id:"title",type:"text",name:"title",ref:T,value:x,onChange:i=>y(i.target.value),placeholder:"Judul Materi",autoComplete:"off"}),e.jsx(G,{message:Y}),e.jsx(n,{htmlFor:"description",className:"sr-only",children:"Deskripsi Materi"}),e.jsx(W,{id:"description",name:"description",value:k,onChange:i=>z(i.target.value),placeholder:"Deskripsi Materi (opsional)",className:"max-h-[300px] min-h-[80px] w-full resize-none break-words whitespace-pre-line",style:{overflowWrap:"break-word",wordBreak:"break-word"}}),e.jsx(n,{htmlFor:"type",className:"sr-only",children:"Tipe Materi"}),e.jsxs(te,{value:s,onValueChange:i=>w(i),children:[e.jsx(ie,{children:e.jsx(ae,{placeholder:"Pilih tipe materi"})}),e.jsx(re,{children:e.jsxs(se,{children:[e.jsx(u,{value:"text",children:"Text"}),e.jsx(u,{value:"video",children:"Video"}),e.jsx(u,{value:"file",children:"File"}),e.jsx(u,{value:"quiz",children:"Quiz"})]})})]}),s==="text"&&e.jsxs("div",{children:[e.jsx(n,{htmlFor:"content",className:"mb-1 block text-sm font-medium",children:"Konten Materi"}),e.jsx(le,{apiKey:"ezdq40mjneld4d8pnta3pfr55y39ttbvvtyp6xrhqswrefxz",value:N,onEditorChange:i=>S(i),init:{plugins:["anchor","autolink","charmap","codesample","emoticons","image","link","lists","media","searchreplace","table","visualblocks","wordcount"],onboarding:!1,toolbar:"undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table mergetags | addcomment showcomments | spellcheckdialog a11ycheck typography | align lineheight | checklist numlist bullist indent outdent | emoticons charmap | removeformat",tinycomments_mode:"embedded",tinycomments_author:"Author name",mergetags_list:[{value:"First.Name",title:"First Name"},{value:"Email",title:"Email"}],height:300}})]}),s==="video"&&e.jsxs("div",{children:[e.jsx(n,{htmlFor:"video-link",className:"mb-1 block text-sm font-medium",children:"Link YouTube Video"}),e.jsx(d,{id:"video-link",type:"text",placeholder:"https://www.youtube.com/watch?v=xxxxxx",value:c,onChange:i=>_(i.target.value)}),c&&c.trim()!==""&&e.jsx("div",{className:"mt-2",children:e.jsx("iframe",{className:"rounded border",width:"100%",height:"250",src:c.includes("youtube.com")||c.includes("youtu.be")?`https://www.youtube.com/embed/${ne(c)}`:"",title:"YouTube Preview",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})]}),s==="file"&&e.jsxs("div",{children:[e.jsx(n,{htmlFor:"attachment",className:"mb-1 block text-sm font-medium",children:"Upload File (Format PDF)"}),e.jsx(d,{id:"attachment",type:"file",onChange:i=>{var o;const l=((o=i.target.files)==null?void 0:o[0])??null;if(l&&l.size>oe){g("Ukuran file maksimal 50 MB"),v(null);return}v(l),l&&l.type!=="application/pdf"&&j(!1)}}),e.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[e.jsx(K,{id:"is-preview",checked:b,onCheckedChange:a&&a.type!=="application/pdf"?void 0:j,className:a&&a.type!=="application/pdf"?"opacity-50 cursor-not-allowed":""}),e.jsx(n,{htmlFor:"is-preview",className:a&&a.type!=="application/pdf"?"text-muted-foreground":"",children:b?"File hanya bisa dilihat (preview)":"File bisa di-download"})]}),a&&a.type!=="application/pdf"&&e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Preview hanya tersedia untuk file PDF. File non-PDF otomatis bisa di-download."}),(()=>{let i=null;return a instanceof File?i={type:"file",url:URL.createObjectURL(a)}:typeof a=="string"&&a&&(i={type:"file",url:a.startsWith("http")?a:`/storage/${a}`}),(i==null?void 0:i.type)==="file"&&i.url&&e.jsxs("div",{className:"mt-2 w-full rounded border p-2",children:[e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs",children:[a instanceof File&&a.type==="application/pdf"||typeof a=="string"&&a?e.jsx("a",{href:i.url,target:"_blank",rel:"noopener noreferrer",className:"mb-2 rounded bg-black/60 px-2 py-1 text-xs text-white hover:bg-black/80",title:"Tampilkan Fullscreen",children:a instanceof File?"Fullscreen":"Lihat File Lama"}):null,a instanceof File&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium",children:"File:"}),e.jsx("span",{children:a.name}),e.jsxs("span",{children:["(",Math.round(a.size/1024)," KB)"]})]})]}),a instanceof File&&a.type==="application/pdf"||typeof a=="string"&&a?e.jsx("object",{data:i.url,type:"application/pdf",width:"100%",height:"200px",children:e.jsxs("p",{children:["Preview tidak tersedia."," ",e.jsx("a",{href:i.url,target:"_blank",rel:"noopener noreferrer",children:"Download PDF"})]})}):e.jsx("div",{className:"text-xs text-muted-foreground italic",children:"Preview hanya tersedia untuk file PDF."})]})})()]}),s==="quiz"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"quiz-instructions",className:"sr-only",children:"Instruksi Quiz"}),e.jsx(W,{id:"quiz-instructions",name:"quiz-instructions",value:q,onChange:i=>C(i.target.value),placeholder:"Instruksi untuk quiz (opsional)",className:"max-h-[300px] min-h-[80px] w-full resize-none break-words whitespace-pre-line",style:{overflowWrap:"break-word",wordBreak:"break-word"}}),e.jsx(n,{htmlFor:"quiz-time-limit",className:"mb-1 block text-sm font-medium",children:"Time Limit (menit)"}),e.jsx(d,{id:"quiz-time-limit",type:"number",min:0,placeholder:"0 (tanpa batas waktu)",value:D,onChange:i=>P(Number(i.target.value))}),e.jsx(n,{htmlFor:"quiz-passing-score",className:"mb-1 block text-sm font-medium",children:"Passing Score"}),e.jsx(d,{id:"quiz-passing-score",type:"number",min:0,max:100,placeholder:"Nilai minimal lulus (0-100)",value:E,onChange:i=>I(Number(i.target.value))})]}),e.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[e.jsx(K,{id:"is-free",checked:f,onCheckedChange:F}),e.jsx(n,{htmlFor:"is-free",children:f?"Materi ini gratis":"Materi ini berbayar"})]})]}),e.jsxs(H,{className:"gap-2",children:[e.jsx(ee,{asChild:!0,children:e.jsx(J,{variant:"secondary",onClick:()=>p(!1),className:"hover:cursor-pointer",children:"Batal"})}),e.jsx(J,{type:"submit",className:"hover:cursor-pointer",children:"Simpan Perubahan"})]})]})]})}export{Le as default};
