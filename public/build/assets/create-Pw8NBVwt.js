import{r as v,j as e,L as ae,S as re}from"./app-DJanRBGl.js";import{B as ne}from"./badge-p-irgz1n.js";import{B as u}from"./button-Bifx8rgB.js";import{C as O}from"./calendar-CGsg3qX5.js";import{C as _}from"./checkbox-BjCFzYYo.js";import{u as te,F as ie,a as t,b as i,c as n,d as l,e as h,f as c,s as le,o as M,i as V,k as oe,l as A,n as g,h as ce,g as m}from"./types-DCbuC9hX.js";import{I as x}from"./input-C5a_LEF8.js";import{P as C,a as w,b as P}from"./popover-CrkFnK1a.js";import{S as I,a as B,b as L,c as R,d as N}from"./select-UDo__-Yq.js";import{T as de}from"./textarea-DIFTQ3aq.js";import{A as me}from"./admin-layout-B_Qa5VjE.js";import{c as z}from"./utils-DR74k2Cn.js";import{T as pe,P as ue}from"./tag-CXXfqOSV.js";import{S as he}from"./shuffle-DtXoOoCq.js";import{C as E}from"./calendar-BFu_Tv1J.js";import{C as J}from"./chevron-down-ysu_lXVV.js";import{P as xe}from"./plus-eKmdHEc1.js";import{X as je}from"./x-BgLTBkg8.js";import{f as U}from"./format-Bp4OdCl_.js";import{i as W}from"./id-Don4TG_0.js";import"./index-BSP57wh6.js";import"./index-CaYodV7O.js";import"./chevron-left-_KMMEj_d.js";import"./createLucideIcon-C0a0JXVI.js";import"./chevron-right-BXsuuH2D.js";import"./index-Cmhq_reI.js";import"./index-DUJzXC_7.js";import"./index-DmWanXx_.js";import"./floating-ui.react-dom-DPYed0W_.js";import"./index-B3-HGKk4.js";import"./index-3EjGfcbu.js";import"./index-B-7nvAfE.js";import"./label-D8bc7pG-.js";import"./Combination-BCQ0aFO3.js";import"./index-D0jymGb1.js";import"./chevron-up-C27pEBqf.js";import"./sonner-C1sHfgUN.js";import"./index-BMMgGDcw.js";import"./breadcrumbs-CDwZdaIA.js";import"./index-CgMUabIG.js";import"./tooltip-DCkcHdKe.js";import"./dropdown-menu-BB6Qm6J4.js";import"./circle-D2lE2dRL.js";import"./user-V0ewPpIP.js";import"./app-sidebar-header-BSBfksQi.js";import"./chevrons-up-down-ZDmbQ5Jj.js";import"./monitor-play-BqQuA5LE.js";import"./banknote-B4h5PG5L.js";import"./dollar-sign-CpDmjeLc.js";const ge=[{title:"Dashboard",href:"/admin/dashboard"},{title:"Kode Diskon",href:"/admin/discount-codes"},{title:"Tambah Kode Diskon",href:"/admin/discount-codes/create"}],fe=M({code:m().min(1,"Kode diskon harus diisi").max(50,"Kode diskon maksimal 50 karakter"),name:m().min(1,"Nama diskon harus diisi").max(255,"Nama diskon maksimal 255 karakter"),description:m().optional(),type:ce(["percentage","fixed"],{required_error:"Jenis diskon harus dipilih"}),value:g().min(1,"Nilai diskon harus lebih dari 0"),minimum_amount:g().optional(),usage_limit:g().optional(),usage_limit_per_user:g().optional(),starts_at:A({required_error:"Tanggal mulai harus dipilih"}),expires_at:A({required_error:"Tanggal berakhir harus dipilih"}),is_active:oe(),applicable_types:V(m()).optional(),applicable_products:V(M({type:m(),id:m(),title:m(),price:g()})).optional()}).refine(d=>!(d.type==="percentage"&&d.value>100),{message:"Persentase tidak boleh lebih dari 100%",path:["value"]}).refine(d=>d.expires_at>d.starts_at,{message:"Tanggal berakhir harus setelah tanggal mulai",path:["expires_at"]});function hs({products:d}){const[q,S]=v.useState(!1),[X,T]=v.useState(!1),[G,D]=v.useState(!1),[y,H]=v.useState("course"),r=te({resolver:le(fe),defaultValues:{code:"",name:"",description:"",type:"percentage",value:10,minimum_amount:void 0,usage_limit:void 0,usage_limit_per_user:void 0,starts_at:new Date,expires_at:new Date(Date.now()+30*24*60*60*1e3),is_active:!0,applicable_types:[],applicable_products:[]}}),f=r.watch("type"),p=r.watch("applicable_types")||[],j=r.watch("applicable_products")||[],Q=()=>{const s="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let a="";for(let o=0;o<8;o++)a+=s.charAt(Math.floor(Math.random()*s.length));r.setValue("code",a)},K=(s,a)=>{const o=p;if(a)r.setValue("applicable_types",[...o,s]);else{r.setValue("applicable_types",o.filter(k=>k!==s));const b=j.filter(k=>k.type!==s);r.setValue("applicable_products",b)}},Y=(s,a)=>{const o={...s,type:a},b=j;b.some(F=>F.id===s.id&&F.type===a)||r.setValue("applicable_products",[...b,o]),D(!1)},Z=s=>{const a=j.filter(o=>!(o.id===s.id&&o.type===s.type));r.setValue("applicable_products",a)},$=()=>{switch(y){case"course":return d.courses;case"webinar":return d.webinars;default:return[]}},ee=s=>{switch(s){case"course":return"Kelas";case"webinar":return"Webinar";default:return s}};function se(s){const a={...s,description:s.description||null,minimum_amount:s.minimum_amount||null,usage_limit:s.usage_limit||null,usage_limit_per_user:s.usage_limit_per_user||null,applicable_types:s.applicable_types&&s.applicable_types.length>0?s.applicable_types:null,applicable_products:s.applicable_products&&s.applicable_products.length>0?s.applicable_products:null,starts_at:s.starts_at.toISOString(),expires_at:s.expires_at.toISOString()};re.post(route("discount-codes.store"),a)}return e.jsxs(me,{breadcrumbs:ge,children:[e.jsx(ae,{title:"Tambah Kode Diskon"}),e.jsxs("div",{className:"px-4 py-4 md:px-6",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Tambah Kode Diskon"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-2xl text-sm",children:"Silakan isi form di bawah ini untuk membuat kode diskon baru. Pastikan semua informasi yang diperlukan telah diisi dengan benar."}),e.jsx(ie,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(se),className:"grid grid-cols-1 items-start gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-6 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{size:16}),e.jsx("h3",{className:"font-medium",children:"Informasi Dasar"})]}),e.jsx(t,{control:r.control,name:"code",render:({field:s})=>e.jsxs(i,{children:[e.jsxs(n,{children:["Kode Diskon ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{children:e.jsx(x,{placeholder:"DISKON2024",...s,onChange:a=>s.onChange(a.target.value.toUpperCase()),className:"font-mono",autoComplete:"off"})}),e.jsx(u,{type:"button",variant:"outline",onClick:Q,children:e.jsx(he,{className:"h-4 w-4"})})]}),e.jsx(h,{children:"Kode unik untuk diskon ini (akan otomatis menjadi huruf besar)"}),e.jsx(c,{})]})}),e.jsx(t,{control:r.control,name:"name",render:({field:s})=>e.jsxs(i,{children:[e.jsxs(n,{children:["Nama Diskon ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(l,{children:e.jsx(x,{placeholder:"Diskon Tahun Baru",...s,autoComplete:"off"})}),e.jsx(c,{})]})}),e.jsx(t,{control:r.control,name:"description",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Deskripsi"}),e.jsx(l,{children:e.jsx(de,{placeholder:"Deskripsi kode diskon...",...s,value:s.value||"",autoComplete:"off",rows:3})}),e.jsx(c,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 items-start gap-4",children:[e.jsx(t,{control:r.control,name:"type",render:({field:s})=>e.jsxs(i,{children:[e.jsxs(n,{children:["Jenis Diskon ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(I,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(l,{children:e.jsx(B,{children:e.jsx(L,{placeholder:"Pilih jenis diskon"})})}),e.jsxs(R,{children:[e.jsx(N,{value:"percentage",children:"Persentase (%)"}),e.jsx(N,{value:"fixed",children:"Nominal (Rp)"})]})]}),e.jsx(c,{})]})}),e.jsx(t,{control:r.control,name:"value",render:({field:s})=>e.jsxs(i,{children:[e.jsxs(n,{children:["Nilai ",f==="percentage"?"Persentase":"Nominal"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(l,{children:e.jsx(x,{type:"number",placeholder:f==="percentage"?"10":"50000",...s,onChange:a=>s.onChange(Number(a.target.value)),min:"1",max:f==="percentage"?100:void 0})}),e.jsx(h,{children:f==="percentage"?"Masukkan nilai 1-100":"Masukkan nominal dalam Rupiah"}),e.jsx(c,{})]})})]}),e.jsx(t,{control:r.control,name:"minimum_amount",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Minimum Pembelian"}),e.jsx(l,{children:e.jsx(x,{type:"number",placeholder:"100000",...s,onChange:a=>s.onChange(a.target.value?Number(a.target.value):void 0),value:s.value||"",min:"0"})}),e.jsx(h,{children:"Kosongkan untuk tidak membatasi"}),e.jsx(c,{})]})})]}),e.jsxs("div",{className:"space-y-6 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{size:16}),e.jsx("h3",{className:"font-medium",children:"Penggunaan & Validitas"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(t,{control:r.control,name:"usage_limit",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Batas Penggunaan Total"}),e.jsx(l,{children:e.jsx(x,{type:"number",placeholder:"100",...s,onChange:a=>s.onChange(a.target.value?Number(a.target.value):void 0),value:s.value||"",min:"1"})}),e.jsx(h,{children:"Kosongkan untuk tidak membatasi"}),e.jsx(c,{})]})}),e.jsx(t,{control:r.control,name:"usage_limit_per_user",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Batas Per User"}),e.jsx(l,{children:e.jsx(x,{type:"number",placeholder:"1",...s,onChange:a=>s.onChange(a.target.value?Number(a.target.value):void 0),value:s.value||"",min:"1"})}),e.jsx(h,{children:"Kosongkan untuk tidak membatasi"}),e.jsx(c,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(t,{control:r.control,name:"starts_at",render:({field:s})=>e.jsxs(i,{className:"flex flex-col",children:[e.jsxs(n,{children:["Tanggal Mulai ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(C,{open:q,onOpenChange:S,children:[e.jsx(w,{asChild:!0,children:e.jsx(l,{children:e.jsxs(u,{variant:"outline",className:z("justify-between text-left font-normal",!s.value&&"text-muted-foreground"),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),s.value?U(s.value,"dd MMM yyyy",{locale:W}):"Pilih tanggal"]}),e.jsx(J,{className:"h-4 w-4"})]})})}),e.jsx(P,{className:"w-auto overflow-hidden p-0",align:"start",children:e.jsx(O,{mode:"single",selected:s.value,captionLayout:"dropdown",onSelect:a=>{a&&s.onChange(a),S(!1)},disabled:a=>a<new Date,initialFocus:!0})})]}),e.jsx(c,{})]})}),e.jsx(t,{control:r.control,name:"expires_at",render:({field:s})=>e.jsxs(i,{className:"flex flex-col",children:[e.jsxs(n,{children:["Tanggal Berakhir ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(C,{open:X,onOpenChange:T,children:[e.jsx(w,{asChild:!0,children:e.jsx(l,{children:e.jsxs(u,{variant:"outline",className:z("justify-between text-left font-normal",!s.value&&"text-muted-foreground"),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),s.value?U(s.value,"dd MMM yyyy",{locale:W}):"Pilih tanggal"]}),e.jsx(J,{className:"h-4 w-4"})]})})}),e.jsx(P,{className:"w-auto overflow-hidden p-0",align:"start",children:e.jsx(O,{mode:"single",selected:s.value,captionLayout:"dropdown",onSelect:a=>{a&&s.onChange(a),T(!1)},disabled:a=>a<r.getValues("starts_at"),initialFocus:!0})})]}),e.jsx(c,{})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(n,{children:"Berlaku Untuk Produk"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{id:"course",checked:p.includes("course"),onCheckedChange:s=>K("course",!!s)}),e.jsx(n,{htmlFor:"course",className:"text-sm font-normal",children:"Kelas Online"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{id:"webinar",checked:p.includes("webinar"),onCheckedChange:s=>K("webinar",!!s)}),e.jsx(n,{htmlFor:"webinar",className:"text-sm font-normal",children:"Webinar"})]})]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Kosong = berlaku untuk semua produk"})]}),p.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Produk Spesifik (Opsional)"}),e.jsxs(C,{open:G,onOpenChange:D,children:[e.jsx(w,{asChild:!0,children:e.jsxs(u,{type:"button",variant:"outline",size:"sm",children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Tambah Produk"]})}),e.jsx(P,{className:"w-80",align:"end",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Jenis Produk"}),e.jsxs(I,{value:y,onValueChange:H,children:[e.jsx(B,{children:e.jsx(L,{})}),e.jsxs(R,{children:[p.includes("course")&&e.jsx(N,{value:"course",children:"Kelas Online"}),p.includes("webinar")&&e.jsx(N,{value:"webinar",children:"Webinar"})]})]})]}),e.jsx("div",{className:"max-h-40 space-y-2 overflow-y-auto",children:$().map(s=>e.jsx("div",{className:"flex cursor-pointer items-center justify-between rounded-lg border p-2 hover:bg-gray-50",onClick:()=>Y(s,y),children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.title}),e.jsxs("p",{className:"text-muted-foreground text-xs",children:["Rp ",new Intl.NumberFormat("id-ID").format(s.price)]})]})},s.id))})]})})]})]}),j.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"Produk yang dipilih:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:j.map((s,a)=>e.jsxs(ne,{variant:"secondary",className:"flex items-center gap-2",children:[e.jsxs("span",{children:[ee(s.type),": ",s.title]}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",className:"h-auto p-0 hover:bg-transparent",onClick:()=>Z(s),children:e.jsx(je,{className:"h-3 w-3"})})]},a))})]}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"Kosong = berlaku untuk semua produk dari jenis yang dipilih"})]}),e.jsx(t,{control:r.control,name:"is_active",render:({field:s})=>e.jsxs(i,{className:"flex flex-row items-start space-y-0 space-x-3",children:[e.jsx(l,{children:e.jsx(_,{checked:s.value,onCheckedChange:s.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(n,{children:"Kode diskon aktif"}),e.jsx(h,{children:"Centang untuk mengaktifkan kode diskon"})]})]})})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(u,{type:"submit",className:"hover:cursor-pointer",children:"Simpan Kode Diskon"})})]})})]})]})}export{hs as default};
