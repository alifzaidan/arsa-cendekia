import{r as N,j as e,L as re,S as te}from"./app-0I1QzVTg.js";import{B as ne}from"./badge-CjFQCB4e.js";import{B as u}from"./button-D2ZpcnoY.js";import{C as M}from"./calendar-C7CkyaD-.js";import{C as _}from"./checkbox-BahJMLR_.js";import{u as ie,F as le,a as i,b as l,c as n,d as o,f as h,e as d}from"./form-B8Qa-gsK.js";import{I as x}from"./input-BEoPePt1.js";import{P as C,a as S,b as T}from"./popover-OVqhZvMy.js";import{S as V,a as A,b as B,c as I,d as g}from"./select-VJ5t5ozs.js";import{T as oe}from"./textarea-BFAtLBqy.js";import{A as ce}from"./admin-layout-uhp-ZAsE.js";import{c as E}from"./utils-liWpcwDK.js";import{s as de,o as L,a as U,d as me,f as R,n as f,e as pe,b as p}from"./types-UNewp8nY.js";import{T as ue,P as he}from"./tag-C9Li3RHo.js";import{S as xe}from"./shuffle-BuPWGsx7.js";import{C as z}from"./calendar-ChXQrJJ2.js";import{C as J}from"./chevron-down-B9nJkVIc.js";import{P as je}from"./plus-DnXklWU2.js";import{X as ge}from"./x-C19WkH_u.js";import{f as W}from"./format-Bp4OdCl_.js";import{i as q}from"./id-Don4TG_0.js";import"./index-Bota6Y3-.js";import"./index-57D5-Vr4.js";import"./chevron-left-B3Wkr27h.js";import"./createLucideIcon-CstU9H3f.js";import"./chevron-right-c3YFH7gb.js";import"./index-BS3cphgy.js";import"./index-uHisoZSR.js";import"./index-D2fVTj-3.js";import"./floating-ui.react-dom-BJinGOXu.js";import"./index-ByifcKOL.js";import"./index-B7VqJuUm.js";import"./check-Bn2WpFkP.js";import"./label-B5pGucUU.js";import"./Combination-DeKqWJgp.js";import"./index-C2hMLgem.js";import"./chevron-up-B02KnPY6.js";import"./sonner-DAwbnb_L.js";import"./index-_fiB5kas.js";import"./breadcrumbs-D7kDS1RW.js";import"./index-gMo3zbQG.js";import"./tooltip-Bgr99O1S.js";import"./dropdown-menu-Ba8NYkgA.js";import"./circle-GcGN6Pbe.js";import"./user-DFjCH8AI.js";import"./app-sidebar-header-Bs1CQ6bQ.js";import"./chevrons-up-down-BUcrswdO.js";import"./user-check-CU66v9ir.js";import"./users-DxOrkHQM.js";import"./monitor-play-CKPUeDqI.js";import"./presentation-DuCFxc_8.js";import"./banknote-BUu1f0Ei.js";import"./dollar-sign-D30D1dLF.js";const fe=[{title:"Dashboard",href:"/admin/dashboard"},{title:"Kode Diskon",href:"/admin/discount-codes"},{title:"Edit Kode Diskon",href:"#"}],be=L({code:p().min(1,"Kode diskon harus diisi").max(50,"Kode diskon maksimal 50 karakter"),name:p().min(1,"Nama diskon harus diisi").max(255,"Nama diskon maksimal 255 karakter"),description:p().optional(),type:pe(["percentage","fixed"],{required_error:"Jenis diskon harus dipilih"}),value:f().min(1,"Nilai diskon harus lebih dari 0"),minimum_amount:f().optional(),usage_limit:f().optional(),usage_limit_per_user:f().optional(),starts_at:R({required_error:"Tanggal mulai harus dipilih"}),expires_at:R({required_error:"Tanggal berakhir harus dipilih"}),is_active:me(),applicable_types:U(p()).optional(),applicable_products:U(L({type:p(),id:p(),title:p(),price:f()})).optional()}).refine(t=>!(t.type==="percentage"&&t.value>100),{message:"Persentase tidak boleh lebih dari 100%",path:["value"]}).refine(t=>t.expires_at>t.starts_at,{message:"Tanggal berakhir harus setelah tanggal mulai",path:["expires_at"]});function bs({discountCode:t,products:y}){const[X,D]=N.useState(!1),[$,K]=N.useState(!1),[G,F]=N.useState(!1),[w,H]=N.useState("course"),r=ie({resolver:de(be),defaultValues:{code:t.code,name:t.name,description:t.description||"",type:t.type,value:t.value,minimum_amount:t.minimum_amount||void 0,usage_limit:t.usage_limit||void 0,usage_limit_per_user:t.usage_limit_per_user||void 0,starts_at:new Date(t.starts_at),expires_at:new Date(t.expires_at),is_active:t.is_active,applicable_types:t.applicable_types||[],applicable_products:t.applicable_products||[]}}),b=r.watch("type"),m=r.watch("applicable_types")||[],j=r.watch("applicable_products")||[],Q=()=>{const s="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let a="";for(let c=0;c<8;c++)a+=s.charAt(Math.floor(Math.random()*s.length));r.setValue("code",a)},P=(s,a)=>{const c=m;if(a)r.setValue("applicable_types",[...c,s]);else{r.setValue("applicable_types",c.filter(v=>v!==s));const k=j.filter(v=>v.type!==s);r.setValue("applicable_products",k)}},Y=(s,a)=>{const c={...s,type:a},k=j;k.some(O=>O.id===s.id&&O.type===a)||r.setValue("applicable_products",[...k,c]),F(!1)},Z=s=>{const a=j.filter(c=>!(c.id===s.id&&c.type===s.type));r.setValue("applicable_products",a)},ee=()=>{switch(w){case"course":return y.courses;case"bootcamp":return y.bootcamps;case"webinar":return y.webinars;default:return[]}},se=s=>{switch(s){case"course":return"Kelas";case"bootcamp":return"Bootcamp";case"webinar":return"Webinar";default:return s}};function ae(s){const a={...s,description:s.description||null,minimum_amount:s.minimum_amount||null,usage_limit:s.usage_limit||null,usage_limit_per_user:s.usage_limit_per_user||null,applicable_types:s.applicable_types&&s.applicable_types.length>0?s.applicable_types:null,applicable_products:s.applicable_products&&s.applicable_products.length>0?s.applicable_products:null,starts_at:s.starts_at.toISOString(),expires_at:s.expires_at.toISOString(),_method:"PUT"};te.post(route("discount-codes.update",t.id),a)}return e.jsxs(ce,{breadcrumbs:fe,children:[e.jsx(re,{title:`Edit Kode Diskon - ${t.name}`}),e.jsxs("div",{className:"px-4 py-4 md:px-6",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Edit Kode Diskon"}),e.jsxs("p",{className:"text-muted-foreground mb-6 max-w-2xl text-sm",children:['Ubah pengaturan kode diskon "',t.name,'". Pastikan semua informasi yang diperlukan telah diisi dengan benar.']}),e.jsx(le,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(ae),className:"grid grid-cols-1 items-start gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-6 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{size:16}),e.jsx("h3",{className:"font-medium",children:"Informasi Dasar"})]}),e.jsx(i,{control:r.control,name:"code",render:({field:s})=>e.jsxs(l,{children:[e.jsxs(n,{children:["Kode Diskon ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{children:e.jsx(x,{placeholder:"DISKON2024",...s,onChange:a=>s.onChange(a.target.value.toUpperCase()),className:"font-mono",autoComplete:"off"})}),e.jsx(u,{type:"button",variant:"outline",onClick:Q,children:e.jsx(xe,{className:"h-4 w-4"})})]}),e.jsx(h,{children:"Kode unik untuk diskon ini (akan otomatis menjadi huruf besar)"}),e.jsx(d,{})]})}),e.jsx(i,{control:r.control,name:"name",render:({field:s})=>e.jsxs(l,{children:[e.jsxs(n,{children:["Nama Diskon ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{children:e.jsx(x,{placeholder:"Diskon Tahun Baru",...s,autoComplete:"off"})}),e.jsx(d,{})]})}),e.jsx(i,{control:r.control,name:"description",render:({field:s})=>e.jsxs(l,{children:[e.jsx(n,{children:"Deskripsi"}),e.jsx(o,{children:e.jsx(oe,{placeholder:"Deskripsi kode diskon...",...s,value:s.value||"",autoComplete:"off",rows:3})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 items-start gap-4",children:[e.jsx(i,{control:r.control,name:"type",render:({field:s})=>e.jsxs(l,{children:[e.jsxs(n,{children:["Jenis Diskon ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(V,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(o,{children:e.jsx(A,{children:e.jsx(B,{placeholder:"Pilih jenis diskon"})})}),e.jsxs(I,{children:[e.jsx(g,{value:"percentage",children:"Persentase (%)"}),e.jsx(g,{value:"fixed",children:"Nominal (Rp)"})]})]}),e.jsx(d,{})]})}),e.jsx(i,{control:r.control,name:"value",render:({field:s})=>e.jsxs(l,{children:[e.jsxs(n,{children:["Nilai ",b==="percentage"?"Persentase":"Nominal"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{children:e.jsx(x,{type:"number",placeholder:b==="percentage"?"10":"50000",...s,onChange:a=>s.onChange(Number(a.target.value)),min:"1",max:b==="percentage"?100:void 0})}),e.jsx(h,{children:b==="percentage"?"Masukkan nilai 1-100":"Masukkan nominal dalam Rupiah"}),e.jsx(d,{})]})})]}),e.jsx(i,{control:r.control,name:"minimum_amount",render:({field:s})=>e.jsxs(l,{children:[e.jsx(n,{children:"Minimum Pembelian"}),e.jsx(o,{children:e.jsx(x,{type:"number",placeholder:"100000",...s,onChange:a=>s.onChange(a.target.value?Number(a.target.value):void 0),value:s.value||"",min:"0"})}),e.jsx(h,{children:"Kosongkan untuk tidak membatasi"}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"space-y-6 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{size:16}),e.jsx("h3",{className:"font-medium",children:"Penggunaan & Validitas"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{control:r.control,name:"usage_limit",render:({field:s})=>e.jsxs(l,{children:[e.jsx(n,{children:"Batas Penggunaan Total"}),e.jsx(o,{children:e.jsx(x,{type:"number",placeholder:"100",...s,onChange:a=>s.onChange(a.target.value?Number(a.target.value):void 0),value:s.value||"",min:"1"})}),e.jsx(h,{children:"Kosongkan untuk tidak membatasi"}),e.jsx(d,{})]})}),e.jsx(i,{control:r.control,name:"usage_limit_per_user",render:({field:s})=>e.jsxs(l,{children:[e.jsx(n,{children:"Batas Per User"}),e.jsx(o,{children:e.jsx(x,{type:"number",placeholder:"1",...s,onChange:a=>s.onChange(a.target.value?Number(a.target.value):void 0),value:s.value||"",min:"1"})}),e.jsx(h,{children:"Kosongkan untuk tidak membatasi"}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{control:r.control,name:"starts_at",render:({field:s})=>e.jsxs(l,{className:"flex flex-col",children:[e.jsxs(n,{children:["Tanggal Mulai ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(C,{open:X,onOpenChange:D,children:[e.jsx(S,{asChild:!0,children:e.jsx(o,{children:e.jsxs(u,{variant:"outline",className:E("justify-between text-left font-normal",!s.value&&"text-muted-foreground"),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),s.value?W(s.value,"dd MMM yyyy",{locale:q}):"Pilih tanggal"]}),e.jsx(J,{className:"h-4 w-4"})]})})}),e.jsx(T,{className:"w-auto overflow-hidden p-0",align:"start",children:e.jsx(M,{mode:"single",selected:s.value,captionLayout:"dropdown",onSelect:a=>{a&&s.onChange(a),D(!1)},disabled:a=>a<new Date,initialFocus:!0})})]}),e.jsx(d,{})]})}),e.jsx(i,{control:r.control,name:"expires_at",render:({field:s})=>e.jsxs(l,{className:"flex flex-col",children:[e.jsxs(n,{children:["Tanggal Berakhir ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(C,{open:$,onOpenChange:K,children:[e.jsx(S,{asChild:!0,children:e.jsx(o,{children:e.jsxs(u,{variant:"outline",className:E("justify-between text-left font-normal",!s.value&&"text-muted-foreground"),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),s.value?W(s.value,"dd MMM yyyy",{locale:q}):"Pilih tanggal"]}),e.jsx(J,{className:"h-4 w-4"})]})})}),e.jsx(T,{className:"w-auto overflow-hidden p-0",align:"start",children:e.jsx(M,{mode:"single",selected:s.value,captionLayout:"dropdown",onSelect:a=>{a&&s.onChange(a),K(!1)},disabled:a=>a<r.getValues("starts_at"),initialFocus:!0})})]}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(n,{children:"Berlaku Untuk Produk"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{id:"course",checked:m.includes("course"),onCheckedChange:s=>P("course",!!s)}),e.jsx(n,{htmlFor:"course",className:"text-sm font-normal",children:"Kelas Online"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{id:"bootcamp",checked:m.includes("bootcamp"),onCheckedChange:s=>P("bootcamp",!!s)}),e.jsx(n,{htmlFor:"bootcamp",className:"text-sm font-normal",children:"Bootcamp"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{id:"webinar",checked:m.includes("webinar"),onCheckedChange:s=>P("webinar",!!s)}),e.jsx(n,{htmlFor:"webinar",className:"text-sm font-normal",children:"Webinar"})]})]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Kosong = berlaku untuk semua produk"})]}),m.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Produk Spesifik (Opsional)"}),e.jsxs(C,{open:G,onOpenChange:F,children:[e.jsx(S,{asChild:!0,children:e.jsxs(u,{type:"button",variant:"outline",size:"sm",children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"Tambah Produk"]})}),e.jsx(T,{className:"w-80",align:"end",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Jenis Produk"}),e.jsxs(V,{value:w,onValueChange:H,children:[e.jsx(A,{children:e.jsx(B,{})}),e.jsxs(I,{children:[m.includes("course")&&e.jsx(g,{value:"course",children:"Kelas Online"}),m.includes("bootcamp")&&e.jsx(g,{value:"bootcamp",children:"Bootcamp"}),m.includes("webinar")&&e.jsx(g,{value:"webinar",children:"Webinar"})]})]})]}),e.jsx("div",{className:"max-h-40 space-y-2 overflow-y-auto",children:ee().map(s=>e.jsx("div",{className:"flex cursor-pointer items-center justify-between rounded-lg border p-2 hover:bg-gray-50",onClick:()=>Y(s,w),children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.title}),e.jsxs("p",{className:"text-muted-foreground text-xs",children:["Rp ",new Intl.NumberFormat("id-ID").format(s.price)]})]})},s.id))})]})})]})]}),j.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"Produk yang dipilih:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:j.map((s,a)=>e.jsxs(ne,{variant:"secondary",className:"flex items-center gap-2",children:[e.jsxs("span",{children:[se(s.type),": ",s.title]}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",className:"h-auto p-0 hover:bg-transparent",onClick:()=>Z(s),children:e.jsx(ge,{className:"h-3 w-3"})})]},a))})]}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"Kosong = berlaku untuk semua produk dari jenis yang dipilih"})]}),e.jsx(i,{control:r.control,name:"is_active",render:({field:s})=>e.jsxs(l,{className:"flex flex-row items-start space-y-0 space-x-3",children:[e.jsx(o,{children:e.jsx(_,{checked:s.value,onCheckedChange:s.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(n,{children:"Kode diskon aktif"}),e.jsx(h,{children:"Centang untuk mengaktifkan kode diskon"})]})]})})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(u,{type:"submit",className:"hover:cursor-pointer",children:"Simpan Perubahan"})})]})})]})]})}export{bs as default};
