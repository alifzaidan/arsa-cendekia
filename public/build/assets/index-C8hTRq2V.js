import{r as n,j as e,L as A,S}from"./app-DJanRBGl.js";import{B as r}from"./button-Bifx8rgB.js";import{D as O,b as R,g as J,c as L,d as P,e as M}from"./dialog-DaLJLFR-.js";import{C as _}from"./circle-help-CwSCpbyt.js";import{C as z}from"./chevron-left-_KMMEj_d.js";import{C as F}from"./circle-check-big-b17XwAP7.js";import{C as H}from"./circle-x-J-yu6vTC.js";import{C as ee}from"./clock-Bmufvdaj.js";import{C as se}from"./chevron-right-BXsuuH2D.js";import{T as X}from"./triangle-alert-DzyGvCa3.js";import"./index-BSP57wh6.js";import"./index-CaYodV7O.js";import"./utils-DR74k2Cn.js";import"./index-CgMUabIG.js";import"./index-DUJzXC_7.js";import"./Combination-BCQ0aFO3.js";import"./x-BgLTBkg8.js";import"./createLucideIcon-C0a0JXVI.js";function Ne({lesson:h,courseSlug:y}){var B,E;const[d,g]=n.useState(0),[o,b]=n.useState({}),[u,T]=n.useState(!1),[c,Q]=n.useState(null),[j,C]=n.useState(0),[m,q]=n.useState(!1),[I,v]=n.useState(!1),[U,k]=n.useState(!1),s=(B=h.quizzes)==null?void 0:B[0],f=n.useRef(null);n.useEffect(()=>{s!=null&&s.time_limit&&!u&&C(s.time_limit*60)},[s]),n.useEffect(()=>{try{if(j>0&&!u){const a=setInterval(()=>{C(t=>t<=1?($(),0):t-1)},1e3);return()=>clearInterval(a)}}catch(a){console.error("Error in timer useEffect:",a)}},[j,u]),n.useEffect(()=>{if(!(!(s!=null&&s.id)||u))return f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{var t;const a=((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||"";fetch("/quiz/save-progress",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a},body:JSON.stringify({quiz_id:s.id,answers:o}),credentials:"same-origin"})},1e3),()=>{f.current&&clearTimeout(f.current)}},[o,s==null?void 0:s.id,u]),n.useEffect(()=>{s!=null&&s.id&&fetch(`/quiz/get-progress?quiz_id=${s.id}`).then(a=>a.json()).then(a=>{a.answers&&b(a.answers)})},[s==null?void 0:s.id]);const Y=(a,t)=>{b(i=>({...i,[a]:t}))},G=()=>{v(!0)},w=async()=>{var t;if(!(s!=null&&s.id))return;const a=((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||"";await fetch("/quiz/clear-progress",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a},body:JSON.stringify({quiz_id:s.id}),credentials:"same-origin"})},$=async()=>{var a;if(!m){q(!0),v(!1),console.log("Submitting quiz with data:",{quiz_id:s==null?void 0:s.id,answers:o});try{const t=await fetch("/quiz/submit",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"))||""},body:JSON.stringify({quiz_id:s==null?void 0:s.id,answers:o})}),i=await t.json();console.log("Quiz submission response:",i),t.ok?(await w(),Q(i),T(!0)):(console.error("Failed to submit quiz:",i),alert("Gagal mengirim quiz: "+(i.message||i.error||"Unknown error")))}catch(t){console.error("Error submitting quiz:",t),alert("Terjadi kesalahan saat mengirim quiz. Silakan coba lagi.")}finally{q(!1)}}},p=async()=>{if(!u){k(!0);return}await w(),b({}),S.get(`/learn/course/${y}#quiz-${h.id}`)},W=async()=>{await w(),b({}),S.get(`/learn/course/${y}#quiz-${h.id}`)},V=async()=>{await w(),g(0),b({}),T(!1),Q(null),C(s!=null&&s.time_limit?s.time_limit*60:0)},Z=a=>{const t=Math.floor(a/60),i=a%60;return`${t}:${i.toString().padStart(2,"0")}`};if(!s)return e.jsx("div",{className:"bg-background flex min-h-screen items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{className:"text-muted-foreground mx-auto mb-4 h-16 w-16"}),e.jsx("h3",{className:"mb-2 text-lg font-semibold",children:"Quiz Belum Tersedia"}),e.jsx("p",{className:"text-muted-foreground mb-4 text-sm",children:"Quiz untuk materi ini belum tersedia."}),e.jsx(r,{onClick:p,children:"Kembali ke Dashboard"})]})});if(!s.questions||s.questions.length===0)return e.jsx("div",{className:"bg-background flex min-h-screen items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{className:"text-muted-foreground mx-auto mb-4 h-16 w-16"}),e.jsx("h3",{className:"mb-2 text-lg font-semibold",children:"Soal Quiz Belum Tersedia"}),e.jsx("p",{className:"text-muted-foreground mb-4 text-sm",children:"Belum ada soal untuk quiz ini."}),e.jsx(r,{onClick:p,children:"Kembali ke Dashboard"})]})});if(u&&c)return e.jsxs("div",{className:"bg-background min-h-screen",children:[e.jsx(A,{title:`Hasil Quiz: ${s.title}`}),e.jsx("div",{className:"bg-card/50 supports-[backdrop-filter]:bg-card/50 border-b backdrop-blur",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(r,{variant:"ghost",size:"sm",onClick:p,className:"gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Kembali ke Dashboard"]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-xl font-semibold",children:["Hasil Quiz: ",s.title]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:h.title})]})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"mx-auto max-w-4xl",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("div",{className:`mb-4 inline-flex h-16 w-16 items-center justify-center rounded-full ${c.is_passed?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:c.is_passed?e.jsx(F,{className:"h-8 w-8"}):e.jsx(H,{className:"h-8 w-8"})}),e.jsx("h2",{className:"mb-2 text-2xl font-bold",children:c.is_passed?"Selamat! Anda Lulus":"Belum Lulus"}),e.jsxs("div",{className:"text-muted-foreground flex justify-center gap-6 text-sm",children:[e.jsxs("span",{children:["Skor: ",c.score,"%"]}),e.jsxs("span",{children:["Benar: ",c.correct_answers,"/",c.total_questions]}),e.jsxs("span",{children:["Waktu: ",Math.floor(c.time_taken/60),":",(c.time_taken%60).toString().padStart(2,"0")]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx(r,{variant:"outline",onClick:p,children:"← Kembali ke Dashboard Quiz"}),e.jsx(r,{onClick:V,children:"🔄 Ulangi Quiz"})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Review Jawaban"}),(E=c.answers_summary)==null?void 0:E.map((a,t)=>{var K;const i=s.questions.find(l=>l.id===a.question_id);return e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("div",{className:`mb-2 inline-flex items-center gap-2 text-sm font-medium ${a.is_correct?"text-green-600":"text-red-600"}`,children:[a.is_correct?e.jsx(F,{className:"h-4 w-4"}):e.jsx(H,{className:"h-4 w-4"}),"Soal ",t+1," - ",a.is_correct?"Benar":"Salah"]}),e.jsx("p",{className:"mb-3 font-medium",children:a.question}),e.jsxs("div",{className:"space-y-2",children:[(K=a.options)==null?void 0:K.map(l=>e.jsx("div",{className:`rounded border p-2 ${l.is_correct?"border-green-200 bg-green-50":l.id===a.selected_option_id?"border-red-200 bg-red-50":"border-gray-200 bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`h-2 w-2 rounded-full ${l.is_correct?"bg-green-500":l.id===a.selected_option_id?"bg-red-500":"bg-gray-300"}`}),e.jsx("span",{children:l.option_text}),l.is_correct&&e.jsx("span",{className:"text-sm text-green-600",children:"(Jawaban Benar)"}),l.id===a.selected_option_id&&!l.is_correct&&e.jsx("span",{className:"text-sm text-red-600",children:"(Jawaban Anda)"})]})},l.id)),(i==null?void 0:i.explanation)&&e.jsxs("div",{className:"mt-3 rounded border border-blue-200 bg-blue-50 p-3",children:[e.jsx("div",{className:"flex items-start gap-2",children:e.jsx("div",{className:"text-sm font-medium text-blue-600",children:"💡 Pembahasan:"})}),e.jsx("p",{className:"mt-1 text-sm text-blue-800",children:i.explanation})]})]})]},a.question_id)})]})]})})]});const x=s.questions[d],N=s.questions.length,D=Object.keys(o).length;return x?e.jsxs("div",{className:"bg-background min-h-screen",children:[e.jsx(A,{title:`Quiz: ${s.title}`}),e.jsx("div",{className:"bg-card/50 supports-[backdrop-filter]:bg-card/50 border-b backdrop-blur",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(r,{variant:"ghost",size:"sm",onClick:W,className:"gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Kembali"]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-semibold",children:s.title}),e.jsx("p",{className:"text-muted-foreground text-sm",children:h.title})]}),s.time_limit&&j>0?e.jsxs("div",{className:`flex items-center gap-2 rounded-full px-4 py-2 ${j<=60?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"}`,children:[e.jsx(ee,{className:"h-5 w-5"}),e.jsx("span",{className:"text-lg font-medium",children:Z(j)})]}):s.time_limit===0&&e.jsx("div",{className:"rounded border border-red-200 bg-red-50 px-4 py-2 text-sm font-semibold text-red-600",children:"Quiz ini tidak memiliki durasi pengerjaan"})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"mx-auto max-w-4xl",children:[e.jsxs("div",{className:"mb-6",children:[s.instructions&&e.jsx("p",{className:"text-muted-foreground mb-4",children:s.instructions}),e.jsx("div",{className:"mb-2 h-3 rounded-full bg-gray-200",children:e.jsx("div",{className:"h-3 rounded-full bg-blue-900 transition-all duration-300",style:{width:`${(d+1)/N*100}%`}})}),e.jsxs("div",{className:"text-muted-foreground flex justify-between text-sm",children:[e.jsxs("span",{children:["Soal ",d+1," dari ",N]}),e.jsxs("span",{children:[D," jawaban tersimpan"]})]})]}),e.jsxs("div",{className:"flex flex-col gap-6 md:flex-row",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-card mb-6 rounded-lg border p-6",children:[e.jsxs("h3",{className:"mb-6 text-xl font-semibold",children:[d+1,". ",x.question_text]}),e.jsx("div",{className:"space-y-4",children:x.options&&x.options.length>0?x.options.map(a=>e.jsxs("label",{className:"flex cursor-pointer items-center gap-4 rounded-lg border p-4 transition-colors hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:`question-${x.id}`,value:a.id,checked:o[x.id]===a.id,onChange:()=>Y(x.id,a.id),className:"h-5 w-5"}),e.jsx("span",{className:"text-base",children:a.option_text})]},a.id)):e.jsx("div",{className:"text-muted-foreground p-4 text-center",children:e.jsx("p",{children:"Pilihan jawaban belum tersedia untuk soal ini."})})})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(r,{variant:"outline",size:"lg",onClick:()=>g(a=>Math.max(0,a-1)),disabled:d===0,children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Sebelumnya"]}),d===N-1?e.jsx(r,{size:"lg",onClick:G,disabled:m||D===0,children:m?"Mengirim...":"Selesai Quiz"}):e.jsxs(r,{size:"lg",onClick:()=>g(a=>Math.min(N-1,a+1)),disabled:d===N-1,children:["Selanjutnya",e.jsx(se,{className:"ml-2 h-4 w-4"})]})]}),e.jsx("div",{className:"block md:hidden",children:e.jsxs("div",{className:"bg-card mt-2 rounded-lg border p-4",children:[e.jsx("h4",{className:"mb-4 font-semibold",children:"Navigasi Soal"}),e.jsx("div",{className:"mb-4 grid grid-cols-6 gap-2",children:s.questions.map((a,t)=>{var i;return e.jsx("button",{onClick:()=>g(t),className:`h-10 w-10 rounded text-sm font-medium transition-colors ${t===d?"bg-blue-900 text-white":o[(i=s.questions[t])==null?void 0:i.id]?"border border-green-300 bg-green-100 text-green-700":"bg-gray-100 hover:bg-gray-200"}`,children:t+1},t)})})]})})]})]}),e.jsx("div",{className:"hidden w-80 md:block",children:e.jsxs("div",{className:"bg-card sticky top-6 rounded-lg border p-6",children:[e.jsx("h4",{className:"mb-4 font-semibold",children:"Navigasi Soal"}),e.jsx("div",{className:"mb-6 grid grid-cols-6 gap-2",children:s.questions.map((a,t)=>{var i;return e.jsx("button",{onClick:()=>g(t),className:`h-10 w-10 rounded text-sm font-medium transition-colors ${t===d?"bg-blue-900 text-white":o[(i=s.questions[t])==null?void 0:i.id]?"border border-green-300 bg-green-100 text-green-700":"bg-gray-100 hover:bg-gray-200"}`,children:t+1},t)})}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-4 rounded bg-blue-900"}),e.jsx("span",{children:"Soal saat ini"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-4 rounded border border-green-300 bg-green-100"}),e.jsx("span",{children:"Sudah dijawab"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-4 rounded bg-gray-100"}),e.jsx("span",{children:"Belum dijawab"})]})]})})]})})]})]})}),e.jsx(O,{open:I,onOpenChange:v,children:e.jsxs(R,{className:"sm:max-w-[425px]",children:[e.jsxs(J,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-amber-500"}),"Konfirmasi Pengiriman"]}),e.jsx(P,{children:"Setelah dikirim, Anda tidak dapat mengubah jawaban lagi."})]}),e.jsxs(M,{children:[e.jsx(r,{variant:"outline",onClick:()=>v(!1),disabled:m,children:"Batal"}),e.jsx(r,{onClick:$,disabled:m,children:m?"Mengirim...":"Ya, Kirim Jawaban"})]})]})}),e.jsx(O,{open:U,onOpenChange:k,children:e.jsxs(R,{className:"sm:max-w-[425px]",children:[e.jsxs(J,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-amber-500"}),"Konfirmasi Keluar Quiz"]}),e.jsxs(P,{children:["Apakah Anda yakin ingin keluar? ",e.jsx("span",{className:"font-semibold text-red-600",children:"Jawaban Anda tidak akan terekam."})]})]}),e.jsxs(M,{children:[e.jsx(r,{variant:"outline",onClick:()=>k(!1),disabled:m,children:"Batal"}),e.jsx(r,{onClick:()=>{k(!1),S.get(`/learn/course/${y}#quiz-${h.id}`)},disabled:m,children:"Ya, Keluar Quiz"})]})]})})]}):e.jsx("div",{className:"bg-background flex min-h-screen items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{className:"text-muted-foreground mx-auto mb-4 h-16 w-16"}),e.jsx("h3",{className:"mb-2 text-lg font-semibold",children:"Error Loading Question"}),e.jsx("p",{className:"text-muted-foreground mb-4 text-sm",children:"Terjadi kesalahan saat memuat soal."}),e.jsx(r,{onClick:p,children:"Kembali ke Dashboard"})]})})}export{Ne as default};
