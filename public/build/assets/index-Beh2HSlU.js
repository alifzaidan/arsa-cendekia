import{r,S as F,j as e,L as ee}from"./app-C0K1I_jK.js";import{A as se,b as ae,c as te,d as re,e as ie,f as ne,g as le,h as oe}from"./alert-dialog-de0vtAMA.js";import{B as g}from"./button-C0f-v_s_.js";import{D as ce,b as de,g as me,c as ue,d as xe,e as ge}from"./dialog-B2WTaC3E.js";import{P as K}from"./progress-BHl4MN8M.js";import{t as p,T as he}from"./index-CK5zo55w.js";import{A as pe}from"./arrow-left-BGUn8j4g.js";import{C as O}from"./clock-CCxdQXEL.js";import{c as fe}from"./createLucideIcon-DWBoakhq.js";import{M as je}from"./move-right-BMGcB5KX.js";import"./index-7sZO0JmH.js";import"./index-KzWdGhLx.js";import"./index-ckKaZFui.js";import"./Combination-BOkQOgPX.js";import"./utils-CdAyi53O.js";import"./index-f6q-RnpV.js";import"./x-Dpjmwsro.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M6 8L2 12L6 16",key:"kyvwex"}],["path",{d:"M2 12H22",key:"1m8cig"}]],ke=fe("MoveLeft",be);function Fe({quiz:a,attempt:w,user:q}){const h=`quiz_${a.id}_${w.id}_${q.id}`,f=`${h}_timer`,[i,k]=r.useState(0),[m,I]=r.useState({}),[v,N]=r.useState(0),[n,L]=r.useState(!0),[H,_]=r.useState(!1),[R,y]=r.useState(!1),[b,D]=r.useState(!0),[l,E]=r.useState(!1),c=r.useRef(null),u=r.useRef(!1),S=r.useCallback(s=>{const t={timeLeft:s,timestamp:Date.now()};localStorage.setItem(f,JSON.stringify(t))},[f]),C=r.useCallback(()=>{localStorage.removeItem(h),localStorage.removeItem(f)},[h,f]),Y=s=>{const t=Math.floor(s/60),o=s%60;return`${t.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`},P=(s,t)=>{I(o=>({...o,[s]:t}))},J=s=>{k(s)},G=()=>{i<a.questions.length-1&&k(i+1)},W=()=>{i>0&&k(i-1)},x=()=>Object.keys(m).length,U=()=>{_(!0)},z=()=>{C(),c.current&&clearInterval(c.current),F.delete(`/quiz/${a.id}/cancel`)},T=r.useCallback(()=>{if(!u.current){u.current=!0;try{c.current&&clearInterval(c.current);const s=Object.entries(m).map(([t,o])=>({question_id:t,selected_option_id:o}));F.post(`/quiz/${a.id}/submit`,{attempt_id:w.id,answers:s},{onSuccess:()=>{p.success("Quiz berhasil dikumpulkan!"),C()},onError:t=>{console.error("Failed to submit quiz:",t),p.error("Gagal mengumpulkan quiz"),u.current=!1},onFinish:()=>{u.current=!1}})}catch(s){console.error("Failed to prepare submission:",s),p.error("Gagal memproses jawaban"),u.current=!1}}},[m,a.id,w.id,C,c]),B=r.useCallback(()=>{u.current||T()},[T]),M=()=>{const s=x();if(s<a.questions.length){p.error("Belum Lengkap!",{description:`Anda baru mengerjakan ${s} dari ${a.questions.length} soal. Harap lengkapi semua soal terlebih dahulu.`});return}y(!0)},V=()=>{y(!1),T()};r.useEffect(()=>{(()=>{try{const t=localStorage.getItem(h);if(t){const{answers:j,currentQuestionIndex:$}=JSON.parse(t);I(j||{}),k($||0),p.success("Data quiz sebelumnya berhasil dipulihkan")}if(a.time_limit===0){L(!1),N(0),D(!1);return}L(!0);const o=localStorage.getItem(f);if(o){const{timeLeft:j,timestamp:$}=JSON.parse(o),X=Date.now(),Z=Math.floor((X-$)/1e3),Q=Math.max(0,j-Z);N(Q),Q<=0&&E(!0)}else{const j=a.time_limit*60;N(j),S(j)}D(!1)}catch(t){console.error("Failed to initialize quiz:",t),p.error("Gagal memuat data quiz"),D(!1)}})()},[a.id,a.time_limit,S,h,f]),r.useEffect(()=>{if(!b){const s={answers:m,currentQuestionIndex:i,timestamp:Date.now()};localStorage.setItem(h,JSON.stringify(s))}},[m,i,h,b]),r.useEffect(()=>{if(!(!n||b||l||u.current))return c.current=setInterval(()=>{N(s=>{const t=s-1;return S(t),t<=0?(E(!0),c.current&&clearInterval(c.current),0):t})},1e3),()=>{c.current&&clearInterval(c.current)}},[n,b,l,S]),r.useEffect(()=>{n&&l&&!u.current&&(p.error("Waktu habis! Quiz akan dikumpulkan otomatis."),B())},[n,l,B]);const A=x()/a.questions.length*100,d=a.questions[i];return b?e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-32 w-32 animate-spin rounded-full border-b-2 border-gray-900"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Memuat data quiz..."})]})}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:`${a.title}`}),e.jsx("header",{className:"fixed top-0 right-0 left-0 z-50 border-b bg-white/95 shadow-sm backdrop-blur-sm",children:e.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(g,{variant:"secondary",size:"sm",className:"flex items-center gap-2",onClick:U,children:[e.jsx(pe,{className:"h-4 w-4"}),"Kembali"]}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:a.title})]}),n?e.jsxs("div",{className:`flex items-center gap-2 rounded-full border px-3 py-1 text-sm ${v<300?"border-red-200 bg-red-50 text-red-800":"border-primary-foreground bg-gray-50 text-gray-800"}`,children:[e.jsx(O,{className:`h-5 w-5 ${v<300?"text-red-500":"text-orange-500"}`}),e.jsx("span",{className:`text-lg font-semibold ${v<300?"text-red-600":"text-gray-900"}`,children:Y(v)})]}):e.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-blue-200 bg-blue-50 px-3 py-1 text-sm",children:[e.jsx(O,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-blue-700",children:"Tanpa Batas Waktu"})]}),e.jsxs("div",{className:"hidden items-center gap-4 md:flex",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[x(),"/",a.questions.length," dikerjakan"]}),e.jsx(K,{value:A,className:"h-2 w-32 rounded-md"})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between md:hidden",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[x(),"/",a.questions.length," soal dikerjakan"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{value:A,className:"h-2 w-20"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[Math.round(A),"%"]})]})]})]})}),e.jsx("div",{className:"min-h-screen bg-gradient-to-tr from-[#E5EDE3] to-[#F6F0E2]",children:e.jsx("div",{className:"mx-auto max-w-7xl px-4 pt-30 pb-8 md:pt-24",children:e.jsxs("div",{className:"grid grid-cols-1 gap-12 lg:grid-cols-4 lg:gap-6",children:[e.jsxs("div",{className:"lg:col-span-3",children:[e.jsx("div",{className:"rounded-lg border bg-white",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("h2",{className:"mb-2 text-base font-semibold md:text-lg",children:["Soal No.",i+1]})}),e.jsx("div",{className:"mb-6",children:e.jsx("p",{className:"leading-relaxed",children:d==null?void 0:d.question_text})}),e.jsx("div",{className:"space-y-3",children:d==null?void 0:d.options.map(s=>e.jsxs("label",{className:`flex cursor-pointer items-start gap-3 rounded-lg border p-4 transition-colors ${m[d.id]===s.id?"border-primary-foreground bg-primary/20":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:`question-${d.id}`,value:s.id,checked:m[d.id]===s.id,onChange:()=>P(d.id,s.id),className:"mt-1",disabled:n&&l}),e.jsx("span",{className:"text-gray-800",children:s.option_text})]},s.id))})]})}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsxs(g,{onClick:W,disabled:i===0||n&&l,children:[e.jsx(ke,{})," Sebelumnya"]}),i===a.questions.length-1&&x()===a.questions.length?e.jsx(g,{onClick:M,disabled:n&&l,children:"Kumpulkan ðŸš€"}):e.jsxs(g,{onClick:G,disabled:i===a.questions.length-1||n&&l,children:["Selanjutnya ",e.jsx(je,{})]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx("div",{className:"border-primary-foreground bg-accent/80 sticky top-6 rounded-lg border",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"mb-4 text-base font-semibold md:text-lg",children:"Nomor Soal"}),e.jsx("div",{className:"mb-6 flex flex-wrap gap-2",children:Array.from({length:a.questions.length},(s,t)=>{var o;return e.jsx(g,{onClick:()=>J(t),disabled:n&&l,className:`h-10 w-10 rounded text-sm font-medium transition-colors ${m[(o=a.questions[t])==null?void 0:o.id]!==void 0?"bg-primary hover:bg-primary text-white":t===i?"bg-blue-300 text-gray-700 hover:bg-blue-400 hover:text-gray-700":"bg-gray-100 text-gray-700 hover:bg-gray-200 hover:text-gray-700"}`,children:t+1},t)})}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 rounded bg-gray-200"}),e.jsx("span",{children:"Belum Dikerjakan"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-primary h-4 w-4 rounded"}),e.jsx("span",{children:"Sudah Dikerjakan"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 rounded bg-blue-300"}),e.jsx("span",{children:"Nomor Soal Saat Ini"})]})]}),e.jsx(g,{className:"mt-6 w-full",onClick:M,disabled:n&&l,children:n&&l?"Waktu Habis":"Kumpulkan"})]})})})]})})}),e.jsx(se,{open:H,onOpenChange:_,children:e.jsxs(ae,{children:[e.jsxs(te,{children:[e.jsx(re,{children:"Konfirmasi Keluar"}),e.jsx(ie,{children:x()>0?"Yakin ingin keluar? Semua progress dan jawaban akan hilang dan tidak dapat dipulihkan.":"Yakin ingin keluar dari quiz?"})]}),e.jsxs(ne,{children:[e.jsx(le,{children:"Batal"}),e.jsx(oe,{onClick:z,children:"Ya, Keluar"})]})]})}),e.jsx(ce,{open:R,onOpenChange:y,children:e.jsxs(de,{children:[e.jsxs(me,{children:[e.jsx(ue,{children:"Siap Dikumpulkan!"}),e.jsx(xe,{children:x()===a.questions.length?"Semua soal sudah dijawab. Yakin ingin mengumpulkan quiz?":`Anda baru mengerjakan ${x()} dari ${a.questions.length} soal. Yakin ingin mengumpulkan quiz sekarang?`})]}),e.jsxs(ge,{children:[e.jsx(g,{variant:"outline",onClick:()=>y(!1),children:"Batal"}),e.jsx(g,{onClick:V,children:"Ya, Kumpulkan"})]})]})}),e.jsx(he,{position:"top-center",richColors:!0})]})}export{Fe as default};
