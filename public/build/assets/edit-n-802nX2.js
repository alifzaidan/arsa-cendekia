import{r as v,j as e,L as re,S as te}from"./app-BqUceOHM.js";import{B as ne}from"./badge-HFlO_JO1.js";import{B as u}from"./button-BYFoJWp8.js";import{C as M}from"./calendar-BO4yliHm.js";import{C as y}from"./checkbox-BPgcY-s1.js";import{u as ie,F as le,a as i,b as l,c as n,d as o,e as h,f as d,s as oe,o as V,i as A,k as ce,l as I,n as g,h as de,g as m}from"./types-D0LADkni.js";import{I as x}from"./input-CrJ7cRmB.js";import{P as w,a as P,b as C}from"./popover-BDYm47Ds.js";import{S as B,a as E,b as L,c as U,d as N}from"./select-CwLyUUWs.js";import{T as me}from"./textarea-BLPBFeoU.js";import{A as pe}from"./admin-layout-VdizyYdw.js";import{c as R}from"./utils-mqEhXaFl.js";import{T as ue,P as he}from"./tag-UGFWS-Gs.js";import{S as xe}from"./shuffle-9akUKlme.js";import{C as z}from"./calendar-C39QmZGY.js";import{C as J}from"./chevron-down-DwFaSV26.js";import{P as je}from"./plus-DGuQBCOH.js";import{X as ge}from"./x-tDHxr5y1.js";import{f as W}from"./format-Bp4OdCl_.js";import{i as q}from"./id-Don4TG_0.js";import"./index-CEvf_mc-.js";import"./index-DI7JrXI7.js";import"./chevron-left-C1cF9qDW.js";import"./createLucideIcon-BJfuwJgf.js";import"./chevron-right-CuihKpLe.js";import"./index-C6QUwwnC.js";import"./index-D9cjGE-G.js";import"./index-CNkATe98.js";import"./floating-ui.react-dom-UG3bWTGM.js";import"./index-B1rLDJNs.js";import"./index-DRgqPJW7.js";import"./index-M2kYheDt.js";import"./label-DtODoVTV.js";import"./Combination-DwOtRHAb.js";import"./index-BjbMvlVB.js";import"./chevron-up-CFEGMFDn.js";import"./sonner-BUFtKBpQ.js";import"./index-xJU7nXuK.js";import"./breadcrumbs-CGTyVB7o.js";import"./index-CSzozqb3.js";import"./tooltip-DWzUK_EP.js";import"./dropdown-menu-CT26SU0C.js";import"./circle-Dta03x7Z.js";import"./user-ByOD7roL.js";import"./app-sidebar-header-DcLCXufW.js";import"./chevrons-up-down-BTOzCRVp.js";import"./monitor-play-MLsFsx70.js";import"./banknote-DQUeXq3G.js";import"./dollar-sign-B69XJmrc.js";const fe=[{title:"Dashboard",href:"/admin/dashboard"},{title:"Kode Diskon",href:"/admin/discount-codes"},{title:"Edit Kode Diskon",href:"#"}],be=V({code:m().min(1,"Kode diskon harus diisi").max(50,"Kode diskon maksimal 50 karakter"),name:m().min(1,"Nama diskon harus diisi").max(255,"Nama diskon maksimal 255 karakter"),description:m().optional(),type:de(["percentage","fixed"],{required_error:"Jenis diskon harus dipilih"}),value:g().min(1,"Nilai diskon harus lebih dari 0"),minimum_amount:g().optional(),usage_limit:g().optional(),usage_limit_per_user:g().optional(),starts_at:I({required_error:"Tanggal mulai harus dipilih"}),expires_at:I({required_error:"Tanggal berakhir harus dipilih"}),is_active:ce(),applicable_types:A(m()).optional(),applicable_products:A(V({type:m(),id:m(),title:m(),price:g()})).optional()}).refine(t=>!(t.type==="percentage"&&t.value>100),{message:"Persentase tidak boleh lebih dari 100%",path:["value"]}).refine(t=>t.expires_at>t.starts_at,{message:"Tanggal berakhir harus setelah tanggal mulai",path:["expires_at"]});function xs({discountCode:t,products:S}){const[X,T]=v.useState(!1),[$,D]=v.useState(!1),[G,K]=v.useState(!1),[_,H]=v.useState("course"),r=ie({resolver:oe(be),defaultValues:{code:t.code,name:t.name,description:t.description||"",type:t.type,value:t.value,minimum_amount:t.minimum_amount||void 0,usage_limit:t.usage_limit||void 0,usage_limit_per_user:t.usage_limit_per_user||void 0,starts_at:new Date(t.starts_at),expires_at:new Date(t.expires_at),is_active:t.is_active,applicable_types:t.applicable_types||[],applicable_products:t.applicable_products||[]}}),f=r.watch("type"),p=r.watch("applicable_types")||[],j=r.watch("applicable_products")||[],Q=()=>{const s="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let a="";for(let c=0;c<8;c++)a+=s.charAt(Math.floor(Math.random()*s.length));r.setValue("code",a)},F=(s,a)=>{const c=p;if(a)r.setValue("applicable_types",[...c,s]);else{r.setValue("applicable_types",c.filter(k=>k!==s));const b=j.filter(k=>k.type!==s);r.setValue("applicable_products",b)}},Y=(s,a)=>{const c={...s,type:a},b=j;b.some(O=>O.id===s.id&&O.type===a)||r.setValue("applicable_products",[...b,c]),K(!1)},Z=s=>{const a=j.filter(c=>!(c.id===s.id&&c.type===s.type));r.setValue("applicable_products",a)},ee=()=>{switch(_){case"course":return S.courses;case"webinar":return S.webinars;default:return[]}},se=s=>{switch(s){case"course":return"Kelas";case"webinar":return"Webinar";default:return s}};function ae(s){const a={...s,description:s.description||null,minimum_amount:s.minimum_amount||null,usage_limit:s.usage_limit||null,usage_limit_per_user:s.usage_limit_per_user||null,applicable_types:s.applicable_types&&s.applicable_types.length>0?s.applicable_types:null,applicable_products:s.applicable_products&&s.applicable_products.length>0?s.applicable_products:null,starts_at:s.starts_at.toISOString(),expires_at:s.expires_at.toISOString(),_method:"PUT"};te.post(route("discount-codes.update",t.id),a)}return e.jsxs(pe,{breadcrumbs:fe,children:[e.jsx(re,{title:`Edit Kode Diskon - ${t.name}`}),e.jsxs("div",{className:"px-4 py-4 md:px-6",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Edit Kode Diskon"}),e.jsxs("p",{className:"text-muted-foreground mb-6 max-w-2xl text-sm",children:['Ubah pengaturan kode diskon "',t.name,'". Pastikan semua informasi yang diperlukan telah diisi dengan benar.']}),e.jsx(le,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(ae),className:"grid grid-cols-1 items-start gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-6 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{size:16}),e.jsx("h3",{className:"font-medium",children:"Informasi Dasar"})]}),e.jsx(i,{control:r.control,name:"code",render:({field:s})=>e.jsxs(l,{children:[e.jsxs(n,{children:["Kode Diskon ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{children:e.jsx(x,{placeholder:"DISKON2024",...s,onChange:a=>s.onChange(a.target.value.toUpperCase()),className:"font-mono",autoComplete:"off"})}),e.jsx(u,{type:"button",variant:"outline",onClick:Q,children:e.jsx(xe,{className:"h-4 w-4"})})]}),e.jsx(h,{children:"Kode unik untuk diskon ini (akan otomatis menjadi huruf besar)"}),e.jsx(d,{})]})}),e.jsx(i,{control:r.control,name:"name",render:({field:s})=>e.jsxs(l,{children:[e.jsxs(n,{children:["Nama Diskon ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{children:e.jsx(x,{placeholder:"Diskon Tahun Baru",...s,autoComplete:"off"})}),e.jsx(d,{})]})}),e.jsx(i,{control:r.control,name:"description",render:({field:s})=>e.jsxs(l,{children:[e.jsx(n,{children:"Deskripsi"}),e.jsx(o,{children:e.jsx(me,{placeholder:"Deskripsi kode diskon...",...s,value:s.value||"",autoComplete:"off",rows:3})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 items-start gap-4",children:[e.jsx(i,{control:r.control,name:"type",render:({field:s})=>e.jsxs(l,{children:[e.jsxs(n,{children:["Jenis Diskon ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(B,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(o,{children:e.jsx(E,{children:e.jsx(L,{placeholder:"Pilih jenis diskon"})})}),e.jsxs(U,{children:[e.jsx(N,{value:"percentage",children:"Persentase (%)"}),e.jsx(N,{value:"fixed",children:"Nominal (Rp)"})]})]}),e.jsx(d,{})]})}),e.jsx(i,{control:r.control,name:"value",render:({field:s})=>e.jsxs(l,{children:[e.jsxs(n,{children:["Nilai ",f==="percentage"?"Persentase":"Nominal"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{children:e.jsx(x,{type:"number",placeholder:f==="percentage"?"10":"50000",...s,onChange:a=>s.onChange(Number(a.target.value)),min:"1",max:f==="percentage"?100:void 0})}),e.jsx(h,{children:f==="percentage"?"Masukkan nilai 1-100":"Masukkan nominal dalam Rupiah"}),e.jsx(d,{})]})})]}),e.jsx(i,{control:r.control,name:"minimum_amount",render:({field:s})=>e.jsxs(l,{children:[e.jsx(n,{children:"Minimum Pembelian"}),e.jsx(o,{children:e.jsx(x,{type:"number",placeholder:"100000",...s,onChange:a=>s.onChange(a.target.value?Number(a.target.value):void 0),value:s.value||"",min:"0"})}),e.jsx(h,{children:"Kosongkan untuk tidak membatasi"}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"space-y-6 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{size:16}),e.jsx("h3",{className:"font-medium",children:"Penggunaan & Validitas"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{control:r.control,name:"usage_limit",render:({field:s})=>e.jsxs(l,{children:[e.jsx(n,{children:"Batas Penggunaan Total"}),e.jsx(o,{children:e.jsx(x,{type:"number",placeholder:"100",...s,onChange:a=>s.onChange(a.target.value?Number(a.target.value):void 0),value:s.value||"",min:"1"})}),e.jsx(h,{children:"Kosongkan untuk tidak membatasi"}),e.jsx(d,{})]})}),e.jsx(i,{control:r.control,name:"usage_limit_per_user",render:({field:s})=>e.jsxs(l,{children:[e.jsx(n,{children:"Batas Per User"}),e.jsx(o,{children:e.jsx(x,{type:"number",placeholder:"1",...s,onChange:a=>s.onChange(a.target.value?Number(a.target.value):void 0),value:s.value||"",min:"1"})}),e.jsx(h,{children:"Kosongkan untuk tidak membatasi"}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{control:r.control,name:"starts_at",render:({field:s})=>e.jsxs(l,{className:"flex flex-col",children:[e.jsxs(n,{children:["Tanggal Mulai ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(w,{open:X,onOpenChange:T,children:[e.jsx(P,{asChild:!0,children:e.jsx(o,{children:e.jsxs(u,{variant:"outline",className:R("justify-between text-left font-normal",!s.value&&"text-muted-foreground"),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),s.value?W(s.value,"dd MMM yyyy",{locale:q}):"Pilih tanggal"]}),e.jsx(J,{className:"h-4 w-4"})]})})}),e.jsx(C,{className:"w-auto overflow-hidden p-0",align:"start",children:e.jsx(M,{mode:"single",selected:s.value,captionLayout:"dropdown",onSelect:a=>{a&&s.onChange(a),T(!1)},disabled:a=>a<new Date,initialFocus:!0})})]}),e.jsx(d,{})]})}),e.jsx(i,{control:r.control,name:"expires_at",render:({field:s})=>e.jsxs(l,{className:"flex flex-col",children:[e.jsxs(n,{children:["Tanggal Berakhir ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(w,{open:$,onOpenChange:D,children:[e.jsx(P,{asChild:!0,children:e.jsx(o,{children:e.jsxs(u,{variant:"outline",className:R("justify-between text-left font-normal",!s.value&&"text-muted-foreground"),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),s.value?W(s.value,"dd MMM yyyy",{locale:q}):"Pilih tanggal"]}),e.jsx(J,{className:"h-4 w-4"})]})})}),e.jsx(C,{className:"w-auto overflow-hidden p-0",align:"start",children:e.jsx(M,{mode:"single",selected:s.value,captionLayout:"dropdown",onSelect:a=>{a&&s.onChange(a),D(!1)},disabled:a=>a<r.getValues("starts_at"),initialFocus:!0})})]}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(n,{children:"Berlaku Untuk Produk"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{id:"course",checked:p.includes("course"),onCheckedChange:s=>F("course",!!s)}),e.jsx(n,{htmlFor:"course",className:"text-sm font-normal",children:"Kelas Online"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{id:"webinar",checked:p.includes("webinar"),onCheckedChange:s=>F("webinar",!!s)}),e.jsx(n,{htmlFor:"webinar",className:"text-sm font-normal",children:"Webinar"})]})]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Kosong = berlaku untuk semua produk"})]}),p.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Produk Spesifik (Opsional)"}),e.jsxs(w,{open:G,onOpenChange:K,children:[e.jsx(P,{asChild:!0,children:e.jsxs(u,{type:"button",variant:"outline",size:"sm",children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"Tambah Produk"]})}),e.jsx(C,{className:"w-80",align:"end",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Jenis Produk"}),e.jsxs(B,{value:_,onValueChange:H,children:[e.jsx(E,{children:e.jsx(L,{})}),e.jsxs(U,{children:[p.includes("course")&&e.jsx(N,{value:"course",children:"Kelas Online"}),p.includes("webinar")&&e.jsx(N,{value:"webinar",children:"Webinar"})]})]})]}),e.jsx("div",{className:"max-h-40 space-y-2 overflow-y-auto",children:ee().map(s=>e.jsx("div",{className:"flex cursor-pointer items-center justify-between rounded-lg border p-2 hover:bg-gray-50",onClick:()=>Y(s,_),children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.title}),e.jsxs("p",{className:"text-muted-foreground text-xs",children:["Rp ",new Intl.NumberFormat("id-ID").format(s.price)]})]})},s.id))})]})})]})]}),j.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"Produk yang dipilih:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:j.map((s,a)=>e.jsxs(ne,{variant:"secondary",className:"flex items-center gap-2",children:[e.jsxs("span",{children:[se(s.type),": ",s.title]}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",className:"h-auto p-0 hover:bg-transparent",onClick:()=>Z(s),children:e.jsx(ge,{className:"h-3 w-3"})})]},a))})]}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"Kosong = berlaku untuk semua produk dari jenis yang dipilih"})]}),e.jsx(i,{control:r.control,name:"is_active",render:({field:s})=>e.jsxs(l,{className:"flex flex-row items-start space-y-0 space-x-3",children:[e.jsx(o,{children:e.jsx(y,{checked:s.value,onCheckedChange:s.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(n,{children:"Kode diskon aktif"}),e.jsx(h,{children:"Centang untuk mengaktifkan kode diskon"})]})]})})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(u,{type:"submit",className:"hover:cursor-pointer",children:"Simpan Perubahan"})})]})})]})]})}export{xs as default};
