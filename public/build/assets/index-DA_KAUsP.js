import{K as W,r as n,j as e,L as v,$ as O}from"./app-0I1QzVTg.js";import{B as p}from"./button-D2ZpcnoY.js";import{C as Z}from"./checkbox-BahJMLR_.js";import{I as ee}from"./input-BEoPePt1.js";import{L as B}from"./label-B5pGucUU.js";import{S as U}from"./separator-DFkbzSLT.js";import{T as te,a as ae,b as I,c as H}from"./tabs-Ci54nyf0.js";import{U as S}from"./user-layout-BNhF3X2t.js";import{U as z}from"./user-DFjCH8AI.js";import{B as M}from"./badge-check-xDup0vpw.js";import{H as se}from"./hourglass-Cxu9oQ8x.js";import{C as q}from"./check-Bn2WpFkP.js";import{X as re}from"./x-C19WkH_u.js";import"./index-Bota6Y3-.js";import"./index-57D5-Vr4.js";import"./utils-liWpcwDK.js";import"./index-BS3cphgy.js";import"./index-uHisoZSR.js";import"./index-D2fVTj-3.js";import"./floating-ui.react-dom-BJinGOXu.js";import"./index-ByifcKOL.js";import"./index-B7VqJuUm.js";import"./sonner-DAwbnb_L.js";import"./index-_fiB5kas.js";import"./breadcrumbs-D7kDS1RW.js";import"./createLucideIcon-CstU9H3f.js";import"./index-gMo3zbQG.js";import"./Combination-DeKqWJgp.js";import"./tooltip-Bgr99O1S.js";import"./dropdown-menu-Ba8NYkgA.js";import"./index-C2hMLgem.js";import"./circle-GcGN6Pbe.js";import"./chevron-right-c3YFH7gb.js";import"./icon-DCFX0qpW.js";import"./badge-CjFQCB4e.js";import"./command-B6NJ2fw6.js";import"./dialog-x_8xUkrq.js";import"./circle-check-big-Bg27NMmT.js";import"./clock-CZHKhQei.js";import"./house-CW1yAxLJ.js";import"./monitor-play-CKPUeDqI.js";import"./presentation-DuCFxc_8.js";function le(t){const o=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,i=t.match(o);return i&&i[2].length===11?i[2]:""}function ie(t){if(!t)return[];const o=t.match(/<li>(.*?)<\/li>/g);return o?o.map(i=>i.replace(/<\/?li>/g,"").trim()):[]}function Ye({course:t,hasAccess:o,pendingInvoiceUrl:i,referralInfo:c}){var F,D;const{auth:_}=W().props,C=!!_.user,P=C&&((F=_.user)==null?void 0:F.phone_number),d=(D=t.modules)==null?void 0:D.flatMap(s=>s.lessons||[]).find(s=>s.type==="video"&&s.video_url),[b,G]=n.useState(!1),[L,y]=n.useState(!1),[m,X]=n.useState(""),[a,j]=n.useState(null),[T,A]=n.useState(!1),[k,h]=n.useState(""),$=ie(t.key_points),r=t.price===0,N=5e3,J=t.price,Y=(a==null?void 0:a.discount_amount)||0,K=J-Y,E=r?0:K+N;n.useEffect(()=>{const l=new URLSearchParams(window.location.search).get("ref");l?sessionStorage.setItem("referral_code",l):c.code&&sessionStorage.setItem("referral_code",c.code)},[c]),n.useEffect(()=>{if(!m.trim()||r){j(null),h("");return}const s=setTimeout(()=>{V()},500);return()=>clearTimeout(s)},[m]);const V=async()=>{var s;if(!(!m.trim()||r)){A(!0),h("");try{const x=await(await fetch("/api/discount-codes/validate",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.content)||""},credentials:"same-origin",body:JSON.stringify({code:m,amount:t.price,product_type:"course",product_id:t.id})})).json();x.valid?(j(x),h("")):(j(null),h(x.message||"Kode promo tidak valid"))}catch{j(null),h("Terjadi kesalahan saat memvalidasi kode promo")}finally{A(!1)}}},Q=async s=>{var l,x;if(s.preventDefault(),!P){alert("Profil Anda belum lengkap! Harap lengkapi nomor telepon terlebih dahulu."),window.location.href=route("profile.edit");return}if(!b&&!r){alert("Anda harus menyetujui syarat dan ketentuan!");return}if(y(!0),r){try{const u=await fetch(route("enroll.free"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.content)||""},body:JSON.stringify({type:"course",id:t.id,discount_amount:t.strikethrough_price||0,nett_amount:t.price,transaction_fee:0,total_amount:0})}),f=await u.json();u.ok&&f.redirect_url?window.location.href=f.redirect_url:alert(f.message||"Gagal mendaftar kelas gratis.")}catch{alert("Terjadi kesalahan saat proses pendaftaran.")}finally{y(!1)}return}try{const u=t.strikethrough_price>0?t.strikethrough_price-t.price:0,f=(a==null?void 0:a.discount_amount)||0,g={type:"course",id:t.id,discount_amount:u+f,nett_amount:K,transaction_fee:N,total_amount:E};a!=null&&a.valid&&(g.discount_code_id=a.discount_code.id,g.discount_code_amount=a.discount_amount),console.log("Sending invoice data:",g);const R=await fetch(route("invoice.store"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((x=document.querySelector('meta[name="csrf-token"]'))==null?void 0:x.content)||""},credentials:"same-origin",body:JSON.stringify(g)}),w=await R.json();R.ok&&w.url?window.location.href=w.url:alert(w.message||"Gagal membuat invoice.")}catch(u){console.error("Checkout error:",u),alert("Terjadi kesalahan saat proses pembayaran.")}finally{y(!1)}};if(!C){const s=window.location.href,l=route("login",{redirect:s});return e.jsxs(S,{children:[e.jsx(v,{title:"Login Required"}),e.jsx("section",{className:"to-primary w-full bg-gradient-to-tl from-black px-4",children:e.jsxs("div",{className:"mx-auto my-12 w-full max-w-7xl px-4",children:[e.jsxs("h2",{className:"mx-auto mb-4 max-w-3xl bg-gradient-to-r from-[#71D0F7] via-white to-[#E6834A] bg-clip-text text-center text-3xl font-bold text-transparent italic sm:text-4xl",children:['Daftar Kelas Online "',t.title,'"']}),e.jsx("p",{className:"text-center text-gray-400",children:"Silakan login terlebih dahulu untuk mendaftar kelas online."})]})}),e.jsx("section",{className:"mx-auto my-4 w-full max-w-7xl px-4",children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx(z,{size:64,className:"text-blue-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Login Diperlukan"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Anda perlu login terlebih dahulu untuk mendaftar kelas online ini.",c.hasActive&&" Kode referral Anda akan tetap tersimpan."]}),e.jsxs("div",{className:"flex w-full max-w-md gap-2",children:[e.jsx(p,{asChild:!0,className:"flex-1",children:e.jsx("a",{href:l,children:"Login"})}),e.jsx(p,{asChild:!0,variant:"outline",className:"flex-1",children:e.jsx(O,{href:route("register",c.code?{ref:c.code}:{}),children:"Daftar"})})]})]})})]})}return P?e.jsxs(S,{children:[e.jsx(v,{title:"Checkout Kelas"}),e.jsx("section",{className:"to-primary w-full bg-gradient-to-tl from-black px-4",children:e.jsxs("div",{className:"mx-auto my-12 w-full max-w-7xl px-4",children:[e.jsxs("h2",{className:"mx-auto mb-4 max-w-3xl bg-gradient-to-r from-[#71D0F7] via-white to-[#E6834A] bg-clip-text text-center text-3xl font-bold text-transparent italic sm:text-4xl",children:['Checkout Kelas "',t.title,'"']}),e.jsx("p",{className:"text-center text-gray-400",children:r?"Lanjutkan untuk mendapatkan akses gratis ke kelas ini.":"Silakan selesaikan pembayaran untuk mendaftar kelas."})]})}),e.jsx("section",{className:"mx-auto my-4 w-full max-w-7xl px-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3 lg:gap-6",children:[e.jsxs(te,{defaultValue:"detail",className:"lg:col-span-2",children:[e.jsxs(ae,{children:[e.jsx(I,{value:"detail",children:"Detail Kelas"}),e.jsx(I,{value:"preview",children:"Preview Video"})]}),e.jsx(H,{value:"detail",children:e.jsxs("div",{className:"h-full rounded-lg border p-4",children:[e.jsx("h2",{className:"text-3xl font-bold italic",children:"Yang akan kamu pelajari"}),e.jsxs("p",{className:"mt-2 mb-4 text-sm text-gray-600",children:['Berikut adalah beberapa poin penting yang akan kamu pelajari dalam kelas "',t.title,'".']}),e.jsx("ul",{className:"space-y-2",children:$.map((s,l)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(M,{size:18,className:"mt-1 min-w-6 text-green-600"}),e.jsx("p",{className:"text-sm md:text-base",children:s})]},l))})]})}),e.jsx(H,{value:"preview",children:e.jsxs("div",{className:"h-full rounded-lg border p-4",children:[e.jsx("h2",{className:"text-3xl font-bold italic",children:"Preview Video"}),e.jsxs("p",{className:"mt-2 mb-4 text-sm text-gray-600",children:['Berikut adalah preview video dari kelas "',t.title,'". Silakan tonton untuk mendapatkan gambaran materi yang akan dipelajari.']}),e.jsx("div",{className:"aspect-video w-full",children:e.jsx("iframe",{width:"100%",height:"100%",src:d!=null&&d.video_url&&(d.video_url.includes("youtube.com")||d.video_url.includes("youtu.be"))?`https://www.youtube.com/embed/${le(d.video_url)}`:"",title:"YouTube video player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"h-full w-full rounded-xl"})})]})})]}),o?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx(M,{size:64,className:"text-green-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Anda Sudah Memiliki Akses"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Anda sudah terdaftar di kelas ini. Silakan lanjutkan belajar."}),e.jsx(p,{asChild:!0,className:"w-full",children:e.jsx("a",{href:`/profile/my-courses/${t.slug}`,children:"Masuk ke Kelas"})})]}):i?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx(se,{size:64,className:"text-yellow-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Pembayaran Tertunda"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Anda memiliki pembayaran yang belum selesai untuk kelas ini. Silakan lanjutkan untuk membayar."}),e.jsx(p,{asChild:!0,className:"w-full",children:e.jsx("a",{href:i,children:"Lanjutkan Pembayaran"})})]}):e.jsxs("form",{onSubmit:Q,children:[e.jsxs("h2",{className:"my-2 text-xl font-bold italic",children:["Detail ",r?"Pendaftaran":"Pembayaran"]}),e.jsxs("div",{className:"space-y-4 rounded-lg border p-4",children:[r?e.jsx("div",{className:"flex items-center justify-between p-4 text-center",children:e.jsx("span",{className:"w-full text-2xl font-bold text-green-600",children:"KELAS GRATIS"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"promo-code",children:"Kode Promo (Opsional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{id:"promo-code",type:"text",placeholder:"Masukkan kode promo",value:m,onChange:s=>X(s.target.value.toUpperCase()),className:"pr-10"}),T&&e.jsx("div",{className:"absolute top-1/2 right-3 -translate-y-1/2 transform",children:e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-b-2 border-blue-600"})}),!T&&m&&e.jsx("div",{className:"absolute top-1/2 right-3 -translate-y-1/2 transform",children:a!=null&&a.valid?e.jsx(q,{className:"h-4 w-4 text-green-600"}):k?e.jsx(re,{className:"h-4 w-4 text-red-600"}):null})]}),k&&e.jsx("p",{className:"text-sm text-red-600",children:k}),(a==null?void 0:a.valid)&&e.jsxs("div",{className:"rounded-lg border border-green-200 bg-green-50 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-green-600"}),e.jsxs("p",{className:"text-sm font-medium text-green-800",children:['Kode promo "',a.discount_code.code,'" berhasil diterapkan!']})]}),e.jsxs("p",{className:"mt-1 text-xs text-green-600",children:[a.discount_code.name," - Diskon ",a.discount_code.formatted_value]})]})]}),e.jsxs("div",{className:"space-y-2 rounded-lg border p-4",children:[t.strikethrough_price>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Harga Asli"}),e.jsxs("span",{className:"font-semibold text-gray-500 line-through",children:["Rp ",t.strikethrough_price.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Diskon"}),e.jsxs("span",{className:"font-semibold text-red-500",children:["-Rp ",(t.strikethrough_price-t.price).toLocaleString("id-ID")]})]}),e.jsx(U,{className:"my-2"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Harga Kelas"}),e.jsxs("span",{className:"font-semibold text-gray-500",children:["Rp ",t.price.toLocaleString("id-ID")]})]}),(a==null?void 0:a.valid)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["Diskon Promo (",a.discount_code.code,")"]}),e.jsxs("span",{className:"font-semibold text-green-600",children:["-Rp ",a.discount_amount.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Biaya Transaksi"}),e.jsxs("span",{className:"font-semibold text-gray-500",children:["Rp ",N.toLocaleString("id-ID")]})]}),e.jsx(U,{className:"my-2"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Total Pembayaran"}),e.jsxs("span",{className:"text-primary text-xl font-bold",children:["Rp ",E.toLocaleString("id-ID")]})]})]})]}),!r&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{id:"terms",checked:b,onCheckedChange:s=>G(s===!0)}),e.jsxs(B,{htmlFor:"terms",children:["Saya menyetujui"," ",e.jsx("a",{href:"/terms-and-conditions",target:"_blank",rel:"noopener noreferrer",className:"text-blue-700 hover:underline",children:"syarat dan ketentuan"})]})]}),e.jsx(p,{className:"w-full",type:"submit",disabled:(r?!1:!b)||L,children:L?"Memproses...":r?"Dapatkan Akses Gratis Sekarang":"Lanjutkan Pembayaran"})]})]})]})})]}):e.jsxs(S,{children:[e.jsx(v,{title:"Checkout Kelas"}),e.jsx("section",{className:"to-primary w-full bg-gradient-to-tl from-black px-4",children:e.jsxs("div",{className:"mx-auto my-12 w-full max-w-7xl px-4",children:[e.jsxs("h2",{className:"mx-auto mb-4 max-w-3xl bg-gradient-to-r from-[#71D0F7] via-white to-[#E6834A] bg-clip-text text-center text-3xl font-bold text-transparent italic sm:text-4xl",children:['Checkout Kelas "',t.title,'"']}),e.jsx("p",{className:"text-center text-gray-400",children:"Silakan lengkapi profil Anda terlebih dahulu."})]})}),e.jsx("section",{className:"mx-auto my-4 w-full max-w-7xl px-4",children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx(z,{size:64,className:"text-orange-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Profil Belum Lengkap"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Profil Anda belum lengkap! Harap lengkapi nomor telepon terlebih dahulu untuk mendaftar kelas."}),e.jsx(p,{asChild:!0,className:"w-full max-w-md",children:e.jsx(O,{href:route("profile.edit",{redirect:window.location.href}),children:"Lengkapi Profil"})})]})})]})}export{Ye as default};
