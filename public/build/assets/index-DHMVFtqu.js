import{K as X,r as n,j as e,L as w,$ as F}from"./app-k8zswjN4.js";import{B as d}from"./button-DXavOchq.js";import{C as J}from"./checkbox-Ck3k7HZB.js";import{I as Q}from"./input-Dxh7gntF.js";import{L as D}from"./label-C9tmqixz.js";import{S as U}from"./separator-BypEpIKP.js";import{U as v}from"./user-layout-Dpx_9Ala.js";import{U as B}from"./user-CuHVlf3H.js";import{B as V}from"./badge-check-Cr1EfBwO.js";import{H as W}from"./hourglass-BIdAY9bx.js";import{C as H}from"./index-BV5r0t8n.js";import{X as Y}from"./x-Brw5WuUb.js";import"./index-yeKsPfmp.js";import"./index-pHOxZwLY.js";import"./utils-CkV0Qb-V.js";import"./index-DBFJEYa8.js";import"./index-D6V9crY2.js";import"./index-6vY0h7jb.js";import"./floating-ui.react-dom-CRZWRie3.js";import"./index-Bxzk6A-r.js";import"./index-B-dSN1WG.js";import"./sonner-CTwMjNNw.js";import"./index-D_K9UrkW.js";import"./breadcrumbs-BRc7dmCI.js";import"./createLucideIcon-D-iNy-Um.js";import"./index-pXs-r0Ho.js";import"./Combination-BrdjsB_W.js";import"./tooltip-Bn_vQ-Xo.js";import"./index-DQoMunvF.js";import"./dropdown-menu-BMlwBcR9.js";import"./circle-I3bKzACo.js";import"./chevron-right-D9DydK3z.js";import"./mail-B2Yeqegj.js";import"./phone-BA-Op-_N.js";import"./icon-CyrjpY36.js";import"./house-BLwYiQvp.js";import"./monitor-play-BbbNWAOL.js";function Z(t){if(!t)return[];const h=t.match(/<li>(.*?)<\/li>/g);return h?h.map(p=>p.replace(/<\/?li>/g,"").trim()):[]}function De({course:t,hasAccess:h,pendingInvoiceUrl:p,referralInfo:i}){var R,O;const{auth:S}=X().props,_=!!S.user,C=_&&((R=S.user)==null?void 0:R.phone_number);(O=t.modules)==null||O.flatMap(s=>s.lessons||[]).find(s=>s.type==="video"&&s.video_url);const[g,I]=n.useState(!1),[L,y]=n.useState(!1),[o,$]=n.useState(""),[a,f]=n.useState(null),[P,A]=n.useState(!1),[b,x]=n.useState("");Z(t.key_points);const r=t.price===0,N=5e3,M=t.price,q=(a==null?void 0:a.discount_amount)||0,T=M-q,K=r?0:T+N;n.useEffect(()=>{const l=new URLSearchParams(window.location.search).get("ref");l?sessionStorage.setItem("referral_code",l):i.code&&sessionStorage.setItem("referral_code",i.code)},[i]),n.useEffect(()=>{if(!o.trim()||r){f(null),x("");return}const s=setTimeout(()=>{z()},500);return()=>clearTimeout(s)},[o]);const z=async()=>{var s;if(!(!o.trim()||r)){A(!0),x("");try{const c=await(await fetch("/api/discount-codes/validate",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.content)||""},credentials:"same-origin",body:JSON.stringify({code:o,amount:t.price,product_type:"course",product_id:t.id})})).json();c.valid?(f(c),x("")):(f(null),x(c.message||"Kode promo tidak valid"))}catch{f(null),x("Terjadi kesalahan saat memvalidasi kode promo")}finally{A(!1)}}},G=async s=>{var l,c;if(s.preventDefault(),!C){alert("Profil Anda belum lengkap! Harap lengkapi nomor telepon terlebih dahulu."),window.location.href=route("profile.edit");return}if(!g&&!r){alert("Anda harus menyetujui syarat dan ketentuan!");return}if(y(!0),r){try{const m=await fetch(route("enroll.free"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.content)||""},body:JSON.stringify({type:"course",id:t.id,discount_amount:t.strikethrough_price||0,nett_amount:t.price,transaction_fee:0,total_amount:0})}),u=await m.json();m.ok&&u.redirect_url?window.location.href=u.redirect_url:alert(u.message||"Gagal mendaftar kelas gratis.")}catch{alert("Terjadi kesalahan saat proses pendaftaran.")}finally{y(!1)}return}try{const m=t.strikethrough_price>0?t.strikethrough_price-t.price:0,u=(a==null?void 0:a.discount_amount)||0,j={type:"course",id:t.id,discount_amount:m+u,nett_amount:T,transaction_fee:N,total_amount:K};a!=null&&a.valid&&(j.discount_code_id=a.discount_code.id,j.discount_code_amount=a.discount_amount),console.log("Sending invoice data:",j);const E=await fetch(route("invoice.store"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((c=document.querySelector('meta[name="csrf-token"]'))==null?void 0:c.content)||""},credentials:"same-origin",body:JSON.stringify(j)}),k=await E.json();E.ok&&k.url?window.location.href=k.url:alert(k.message||"Gagal membuat invoice.")}catch(m){console.error("Checkout error:",m),alert("Terjadi kesalahan saat proses pembayaran.")}finally{y(!1)}};if(!_){const s=window.location.href,l=route("login",{redirect:s});return e.jsxs(v,{children:[e.jsx(w,{title:"Login Required"}),e.jsx("section",{className:"to-tertiary from-primary w-full bg-gradient-to-br px-4",children:e.jsxs("div",{className:"mx-auto my-12 w-full max-w-7xl px-4",children:[e.jsxs("h2",{className:"mx-auto mb-4 max-w-3xl text-center text-3xl font-bold text-white sm:text-4xl",children:['Daftar Kelas Online "',t.title,'"']}),e.jsx("img",{src:t.thumbnail?`/storage/${t.thumbnail}`:"/assets/images/placeholder.png",alt:t.title,className:"mx-auto my-6 w-full max-w-xl rounded-lg border border-gray-200 shadow-md"}),e.jsx("p",{className:"text-center text-gray-200",children:"Silakan login terlebih dahulu untuk mendaftar kelas online."})]})}),e.jsx("section",{className:"mx-auto my-4 w-full max-w-7xl px-4",children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx(B,{size:64,className:"text-blue-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Login Diperlukan"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Anda perlu login terlebih dahulu untuk mendaftar kelas online ini.",i.hasActive&&" Kode referral Anda akan tetap tersimpan."]}),e.jsxs("div",{className:"flex w-full max-w-md gap-2",children:[e.jsx(d,{asChild:!0,className:"flex-1",children:e.jsx("a",{href:l,children:"Login"})}),e.jsx(d,{asChild:!0,variant:"outline",className:"flex-1",children:e.jsx(F,{href:route("register",i.code?{ref:i.code}:{}),children:"Daftar"})})]})]})})]})}return C?e.jsxs(v,{children:[e.jsx(w,{title:"Checkout Kelas"}),e.jsx("section",{className:"to-tertiary from-primary w-full bg-gradient-to-br px-4",children:e.jsxs("div",{className:"mx-auto my-12 w-full max-w-7xl px-4",children:[e.jsxs("h2",{className:"mx-auto mb-4 max-w-3xl text-center text-3xl font-bold text-white sm:text-4xl",children:['Checkout Kelas "',t.title,'"']}),e.jsx("img",{src:t.thumbnail?`/storage/${t.thumbnail}`:"/assets/images/placeholder.png",alt:t.title,className:"mx-auto my-6 w-full max-w-xl rounded-lg border border-gray-200 shadow-md"}),e.jsx("p",{className:"text-center text-gray-200",children:r?"Lanjutkan untuk mendapatkan akses gratis ke kelas ini.":"Silakan selesaikan pembayaran untuk mendaftar kelas."})]})}),e.jsx("section",{className:"mx-auto my-4 w-full max-w-7xl px-4",children:e.jsx("div",{className:"w-full",children:h?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx(V,{size:64,className:"text-green-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Anda Sudah Memiliki Akses"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Anda sudah terdaftar di kelas ini. Silakan lanjutkan belajar."}),e.jsx(d,{asChild:!0,className:"w-full",children:e.jsx("a",{href:`/profile/my-courses/${t.slug}`,children:"Masuk ke Kelas"})})]}):p?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx(W,{size:64,className:"text-yellow-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Pembayaran Tertunda"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Anda memiliki pembayaran yang belum selesai untuk kelas ini. Silakan lanjutkan untuk membayar."}),e.jsx(d,{asChild:!0,className:"w-full",children:e.jsx("a",{href:p,children:"Lanjutkan Pembayaran"})})]}):e.jsxs("form",{onSubmit:G,children:[e.jsxs("h2",{className:"my-2 text-xl font-bold",children:["Detail ",r?"Pendaftaran":"Pembayaran"]}),e.jsxs("div",{className:"space-y-4 rounded-lg border p-4",children:[r?e.jsx("div",{className:"flex items-center justify-between p-4 text-center",children:e.jsx("span",{className:"w-full text-2xl font-bold text-green-600",children:"KELAS GRATIS"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"promo-code",children:"Kode Promo (Opsional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{id:"promo-code",type:"text",placeholder:"Masukkan kode promo",value:o,onChange:s=>$(s.target.value.toUpperCase()),className:"pr-10"}),P&&e.jsx("div",{className:"absolute top-1/2 right-3 -translate-y-1/2 transform",children:e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-b-2 border-blue-600"})}),!P&&o&&e.jsx("div",{className:"absolute top-1/2 right-3 -translate-y-1/2 transform",children:a!=null&&a.valid?e.jsx(H,{className:"h-4 w-4 text-green-600"}):b?e.jsx(Y,{className:"h-4 w-4 text-red-600"}):null})]}),b&&e.jsx("p",{className:"text-sm text-red-600",children:b}),(a==null?void 0:a.valid)&&e.jsxs("div",{className:"rounded-lg border border-green-200 bg-green-50 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-green-600"}),e.jsxs("p",{className:"text-sm font-medium text-green-800",children:['Kode promo "',a.discount_code.code,'" berhasil diterapkan!']})]}),e.jsxs("p",{className:"mt-1 text-xs text-green-600",children:[a.discount_code.name," - Diskon ",a.discount_code.formatted_value]})]})]}),e.jsxs("div",{className:"space-y-2 rounded-lg border p-4",children:[t.strikethrough_price>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Harga Asli"}),e.jsxs("span",{className:"font-semibold text-gray-500 line-through",children:["Rp ",t.strikethrough_price.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Diskon"}),e.jsxs("span",{className:"font-semibold text-red-500",children:["-Rp ",(t.strikethrough_price-t.price).toLocaleString("id-ID")]})]}),e.jsx(U,{className:"my-2"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Harga Kelas"}),e.jsxs("span",{className:"font-semibold text-gray-500",children:["Rp ",t.price.toLocaleString("id-ID")]})]}),(a==null?void 0:a.valid)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["Diskon Promo (",a.discount_code.code,")"]}),e.jsxs("span",{className:"font-semibold text-green-600",children:["-Rp ",a.discount_amount.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Biaya Transaksi"}),e.jsxs("span",{className:"font-semibold text-gray-500",children:["Rp ",N.toLocaleString("id-ID")]})]}),e.jsx(U,{className:"my-2"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Total Pembayaran"}),e.jsxs("span",{className:"text-primary text-xl font-bold",children:["Rp ",K.toLocaleString("id-ID")]})]})]})]}),!r&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(J,{id:"terms",checked:g,onCheckedChange:s=>I(s===!0)}),e.jsxs(D,{htmlFor:"terms",children:["Saya menyetujui"," ",e.jsx("a",{href:"/terms-and-conditions",target:"_blank",rel:"noopener noreferrer",className:"text-blue-700 hover:underline",children:"syarat dan ketentuan"})]})]}),e.jsx(d,{className:"w-full",type:"submit",disabled:(r?!1:!g)||L,children:L?"Memproses...":r?"Dapatkan Akses Gratis Sekarang":"Lanjutkan Pembayaran"})]})]})})})]}):e.jsxs(v,{children:[e.jsx(w,{title:"Checkout Kelas"}),e.jsx("section",{className:"to-tertiary from-primary w-full bg-gradient-to-br px-4",children:e.jsxs("div",{className:"mx-auto my-12 w-full max-w-7xl px-4",children:[e.jsxs("h2",{className:"mx-auto mb-4 max-w-3xl text-center text-3xl font-bold text-white sm:text-4xl",children:['Checkout Kelas "',t.title,'"']}),e.jsx("img",{src:t.thumbnail?`/storage/${t.thumbnail}`:"/assets/images/placeholder.png",alt:t.title,className:"mx-auto my-6 w-full max-w-xl rounded-lg border border-gray-200 shadow-md"}),e.jsx("p",{className:"text-center text-gray-200",children:"Silakan lengkapi profil Anda terlebih dahulu."})]})}),e.jsx("section",{className:"mx-auto my-4 w-full max-w-7xl px-4",children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx(B,{size:64,className:"text-orange-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Profil Belum Lengkap"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Profil Anda belum lengkap! Harap lengkapi nomor telepon terlebih dahulu untuk mendaftar kelas."}),e.jsx(d,{asChild:!0,className:"w-full max-w-md",children:e.jsx(F,{href:route("profile.edit",{redirect:window.location.href}),children:"Lengkapi Profil"})})]})})]})}export{De as default};
