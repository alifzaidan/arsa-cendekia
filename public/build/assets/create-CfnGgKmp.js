import{r as C,m as w,j as e}from"./app-C0K1I_jK.js";import{B as j}from"./button-C0f-v_s_.js";import{D,b as S,g as P,c as R,d as L}from"./dialog-B2WTaC3E.js";import{I as o}from"./input-DDTkEvwP.js";import{L as i}from"./label-BeufQ9l8.js";import{S as A}from"./switch-BTj87yY5.js";import{t as l}from"./index-CK5zo55w.js";import"./index-ckKaZFui.js";import"./index-f6q-RnpV.js";import"./utils-CdAyi53O.js";import"./index-7sZO0JmH.js";import"./index-KzWdGhLx.js";import"./Combination-BOkQOgPX.js";import"./x-Dpjmwsro.js";import"./createLucideIcon-DWBoakhq.js";function W({open:_,onOpenChange:p,promotions:v}){const[u,n]=C.useState(null),d=v.some(a=>a.is_active===!0),{data:t,setData:s,post:b,processing:c,errors:r,reset:h}=w({promotion_flyer:null,start_date:"",end_date:"",is_active:!1,url_redirect:""}),k=a=>{var f;const m=(f=a.target.files)==null?void 0:f[0];if(m){s("promotion_flyer",m);const y=new FileReader;y.onload=F=>{var g;n((g=F.target)==null?void 0:g.result)},y.readAsDataURL(m)}},N=a=>{if(a.preventDefault(),!t.promotion_flyer){l.error("Gambar flyer wajib diupload");return}if(t.is_active&&d){l.error("Hanya boleh ada satu flyer promosi yang aktif. Nonaktifkan flyer yang aktif terlebih dahulu.");return}b(route("promotions.store"),{onSuccess:()=>{h(),n(null),p(!1),l.success("Flyer promosi berhasil dibuat")},onError:()=>{l.error("Gagal membuat flyer promosi")}})},x=()=>{h(),n(null),p(!1)};return e.jsx(D,{open:_,onOpenChange:x,children:e.jsxs(S,{className:"scrollbar-hide max-h-[90vh] max-w-2xl overflow-y-auto",children:[e.jsxs(P,{children:[e.jsx(R,{children:"Tambah Flyer Promosi"}),e.jsx(L,{children:"Buat flyer promosi baru untuk produk Anda."})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"promotion_flyer",children:"Gambar Flyer *"}),e.jsx(o,{id:"promotion_flyer",type:"file",accept:"image/*",onChange:k,className:"cursor-pointer"}),r.promotion_flyer&&e.jsx("p",{className:"text-sm text-red-600",children:r.promotion_flyer}),u&&e.jsx("div",{className:"mt-4",children:e.jsx("img",{src:u,alt:"Preview flyer",className:"max-h-64 w-full rounded-lg border object-contain"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"start_date",children:"Tanggal Mulai *"}),e.jsx(o,{id:"start_date",type:"date",value:t.start_date,onChange:a=>s("start_date",a.target.value),required:!0}),r.start_date&&e.jsx("p",{className:"text-sm text-red-600",children:r.start_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"end_date",children:"Tanggal Selesai *"}),e.jsx(o,{id:"end_date",type:"date",value:t.end_date,onChange:a=>s("end_date",a.target.value),required:!0}),r.end_date&&e.jsx("p",{className:"text-sm text-red-600",children:r.end_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"url_redirect",children:"URL Redirect"}),e.jsx(o,{id:"url_redirect",type:"url",placeholder:"https://example.com",value:t.url_redirect,onChange:a=>s("url_redirect",a.target.value)}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"URL yang akan dibuka ketika flyer diklik (opsional)"}),r.url_redirect&&e.jsx("p",{className:"text-sm text-red-600",children:r.url_redirect})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{id:"is_active",checked:t.is_active,onCheckedChange:a=>{if(a&&d){l.warning("Sudah ada flyer promosi yang aktif. Nonaktifkan flyer yang aktif terlebih dahulu.");return}s("is_active",a)}}),e.jsx(i,{htmlFor:"is_active",children:t.is_active?"Flyer Aktif":"Flyer Nonaktif"})]}),d&&e.jsx("p",{className:"text-xs text-amber-600",children:"⚠️ Sudah ada flyer promosi yang aktif. Hanya boleh ada satu flyer yang aktif."})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(j,{type:"button",variant:"outline",onClick:x,disabled:c,children:"Batal"}),e.jsx(j,{type:"submit",disabled:c,children:c?"Menyimpan...":"Simpan Flyer"})]})]})]})})}export{W as default};
